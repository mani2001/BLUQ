2025-12-07 17:30:44 - __main__ - INFO - Starting benchmark run
2025-12-07 17:30:44 - __main__ - INFO - Log file: outputs/results/logs/benchmark_20251207_173044.log
2025-12-07 17:30:44 - __main__ - INFO - Mode: long, Samples: 10000
2025-12-07 17:30:44 - __main__ - INFO - Models: ['phi-2']
2025-12-07 17:30:44 - __main__ - INFO - Tasks: ['qa', 'rc', 'ci', 'drs', 'ds']
2025-12-07 17:30:44 - __main__ - INFO - Dtypes: ['float16']
2025-12-07 17:30:51 - __main__ - INFO - Running on: Device: NVIDIA A100 80GB PCIe (cuda)
  Total Memory: 79.25 GB
  Available Memory: 79.25 GB
2025-12-07 17:30:51 - src.utils.gpu - INFO - Detected A100 GPU: NVIDIA A100 80GB PCIe - using optimized A100 settings
2025-12-07 17:30:51 - __main__ - INFO - GPU Tier: a100 | Auto max_batch_size: 192 | Safety margin: 0.93
2025-12-07 17:30:51 - __main__ - INFO - Auto-detected max_batch_size: 192
2025-12-07 17:30:51 - src.utils.gpu - INFO - Detected A100 GPU: NVIDIA A100 80GB PCIe - using optimized A100 settings
2025-12-07 17:30:51 - src.utils.gpu - INFO - Initialized GPUMemoryManager:
Device: NVIDIA A100 80GB PCIe (cuda)
  Total Memory: 79.25 GB
  Available Memory: 79.25 GB
  GPU Tier: a100
  Safety Margin: 0.93
  Activation Multiplier: 0.4
  Max Batch Size: 192
2025-12-07 17:30:51 - src.utils.gpu - INFO - NVML initialized for GPU utilization monitoring
2025-12-07 17:30:51 - src.utils.gpu - INFO - GPUProfiler initialized (CUDA: True, NVML: True)
2025-12-07 17:30:51 - src.utils.gpu - INFO - Started GPU monitoring
2025-12-07 17:30:51 - __main__ - INFO - GPU profiling enabled
2025-12-07 17:30:51 - __main__ - INFO - 
================================================================================
2025-12-07 17:30:51 - __main__ - INFO - FULL BENCHMARK CONFIGURATION
2025-12-07 17:30:51 - __main__ - INFO - ================================================================================
2025-12-07 17:30:51 - __main__ - INFO - Models (1): ['phi-2']
2025-12-07 17:30:51 - __main__ - INFO - Tasks (5): ['qa', 'rc', 'ci', 'drs', 'ds']
2025-12-07 17:30:51 - __main__ - INFO - Data types: ['float16']
2025-12-07 17:30:51 - __main__ - INFO - Samples per task: 10000
2025-12-07 17:30:51 - __main__ - INFO - Alpha (error rate): 0.1
2025-12-07 17:30:51 - __main__ - INFO - Strategies: ['base']
2025-12-07 17:30:51 - __main__ - INFO - Conformal methods: ['lac', 'aps']
2025-12-07 17:30:51 - __main__ - INFO - Dynamic batch sizing: True
2025-12-07 17:30:51 - __main__ - INFO - Max batch size: 192 (GPU tier: a100)
2025-12-07 17:30:51 - __main__ - INFO - Output directory: outputs/results
2025-12-07 17:30:51 - __main__ - INFO - 
================================================================================
2025-12-07 17:30:51 - __main__ - INFO - Run 1/5: phi-2 | qa | float16
2025-12-07 17:30:51 - __main__ - INFO - ================================================================================
2025-12-07 17:30:58 - src.utils.gpu - INFO - [start_phi-2_qa] GPU State: Allocated: 0.0MB | Reserved: 0.0MB | Free: 81152.8MB | Utilization: 0.0%
2025-12-07 17:30:58 - __main__ - INFO - Loading qa dataset (10000 samples)...
2025-12-07 17:30:58 - src.data.dataset_loader - INFO - Loading MMLU dataset with 10000 samples...
2025-12-07 17:31:03 - src.data.dataset_loader - INFO - Loaded 10000 MMLU instances
2025-12-07 17:31:03 - src.utils.gpu - INFO - [dataset_loading] Duration: 4965.74ms | GPU Memory: 0.0MB -> 0.0MB (delta +0.0MB)
2025-12-07 17:31:03 - src.data.dataset_processor - INFO - Processing qa dataset to 6-option format...
2025-12-07 17:31:03 - src.data.dataset_processor - INFO - Processed 10000 instances for qa
2025-12-07 17:31:03 - src.data.data_splitter - INFO - Splitting qa dataset (calibration: 50%, test: 50%)
2025-12-07 17:31:03 - src.data.data_splitter - INFO - Split complete:
2025-12-07 17:31:03 - src.data.data_splitter - INFO -   Calibration: 4998 instances
2025-12-07 17:31:03 - src.data.data_splitter - INFO -   Test: 5002 instances
2025-12-07 17:31:03 - src.data.data_splitter - WARNING - Calibration size 4998 differs from expected 5000
2025-12-07 17:31:03 - src.data.data_splitter - INFO - Answer distribution:
2025-12-07 17:31:03 - src.data.data_splitter - INFO -   Calibration: {'A': 1174, 'B': 1230, 'C': 1242, 'D': 1352}
2025-12-07 17:31:03 - src.data.data_splitter - INFO -   Test: {'A': 1175, 'B': 1231, 'C': 1243, 'D': 1353}
2025-12-07 17:31:03 - src.utils.gpu - INFO - [dataset_processing] Duration: 46.52ms | GPU Memory: 0.0MB -> 0.0MB (delta +0.0MB)
2025-12-07 17:31:03 - src.prompting.demonstration_manager - INFO - Initialized DemonstrationSelector
2025-12-07 17:31:03 - src.prompting.demonstration_manager - INFO -   Strategy: random
2025-12-07 17:31:03 - src.prompting.demonstration_manager - INFO -   Num demonstrations: 5
2025-12-07 17:31:03 - src.prompting.demonstration_manager - INFO - Initialized DemonstrationManager
2025-12-07 17:31:03 - src.prompting.demonstration_manager - INFO - Selecting 5 demonstrations using 'random' strategy
2025-12-07 17:31:03 - src.prompting.demonstration_manager - INFO - Selected and cached 5 demonstrations for qa
2025-12-07 17:31:03 - __main__ - INFO - Loading model: phi-2 (float16)
2025-12-07 17:31:03 - src.models.model_loader - INFO - Loading model: phi-2_float16 (microsoft/phi-2)
2025-12-07 17:31:03 - src.models.model_loader - INFO - Loading tokenizer from microsoft/phi-2
2025-12-07 17:31:04 - src.models.model_loader - INFO - Tokenizer loaded successfully
2025-12-07 17:31:04 - src.models.model_loader - INFO -   Vocab size: 50295
2025-12-07 17:31:04 - src.models.model_loader - INFO -   Padding side: left
2025-12-07 17:31:04 - src.models.model_loader - INFO -   PAD token: <|endoftext|> (ID: 50256)
2025-12-07 17:31:04 - src.models.model_loader - INFO - Loading model from microsoft/phi-2
2025-12-07 17:32:25 - accelerate.utils.modeling - INFO - We will use 90% of the memory on device 0 for storing the model, and 10% for the buffer to avoid OOM. You can set `max_memory` in to a higher value to use more memory (at your own risk).
2025-12-07 17:32:33 - src.models.model_loader - INFO - Model loaded successfully
2025-12-07 17:32:33 - src.models.model_loader - INFO -   GPU Memory: 5.18GB allocated, 5.18GB reserved
2025-12-07 17:32:33 - src.utils.gpu - INFO - [model_loading] Duration: 90042.32ms | GPU Memory: 0.0MB -> 5301.8MB (delta +5301.8MB)
2025-12-07 17:32:33 - src.utils.gpu - INFO - [after_model_load_phi-2] GPU State: Allocated: 5301.8MB | Reserved: 5308.0MB | Free: 75850.9MB | Utilization: 100.0%
2025-12-07 17:32:33 - src.utils.gpu - INFO - Optimal batch size for 2.7B model (float16): 31
  Available memory: 73.70GB
  Model memory: 5.40GB
  Memory per batch item: 2.160GB
2025-12-07 17:32:33 - __main__ - INFO - Using batch size: 31
2025-12-07 17:32:33 - __main__ - INFO -   Strategy: base
2025-12-07 17:32:33 - src.prompting.prompt_builder - INFO - Initialized PromptBuilder for task: qa
2025-12-07 17:32:33 - src.prompting.prompt_builder - INFO -   Available strategies: ['base', 'shared_instruction', 'task_specific']
2025-12-07 17:32:33 - src.prompting.prompt_builder - INFO - Building 10000 prompts using 'base' strategy with 5 demonstrations
2025-12-07 17:32:33 - src.models.inference_engine - INFO - Initialized InferenceEngine for phi-2_float16
2025-12-07 17:32:33 - src.models.inference_engine - INFO -   Device: cuda:0
2025-12-07 17:32:33 - src.models.inference_engine - INFO -   Batch size: 31
2025-12-07 17:32:33 - src.models.inference_engine - INFO -   Option tokens: {'A': 32, 'B': 33, 'C': 34, 'D': 35, 'E': 36, 'F': 37}
2025-12-07 17:43:30 - src.utils.gpu - INFO - [inference_calibration] Duration: 656388.84ms | GPU Memory: 5301.8MB -> 5311.0MB (delta +9.1MB)
2025-12-07 17:49:50 - src.utils.gpu - INFO - [inference_test] Duration: 380311.71ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 17:49:50 - __main__ - INFO -     Inference: 1036.70s for 10000 samples (9.65 samples/sec)
2025-12-07 17:49:50 - src.models.probability_extractor - INFO - Initialized ProbabilityExtractor
2025-12-07 17:49:50 - src.models.probability_extractor - INFO -   Temperature: 1.0
2025-12-07 17:49:50 - src.models.probability_extractor - INFO -   Calibration method: None
2025-12-07 17:49:50 - src.utils.gpu - INFO - [probability_extraction] Duration: 219.70ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO - Initialized LACScorer
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO -   Alpha: 0.1
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO -   Target coverage: 90.0%
2025-12-07 17:49:50 - src.conformal.scorers - INFO - Initialized LAC (Least Ambiguous set-valued Classifiers) scorer
2025-12-07 17:49:50 - src.conformal.prediction_set_generator - INFO - Initialized PredictionSetGenerator
2025-12-07 17:49:50 - src.conformal.prediction_set_generator - INFO -   Methods: ['lac']
2025-12-07 17:49:50 - src.conformal.prediction_set_generator - INFO -   Alpha: 0.1
2025-12-07 17:49:50 - src.conformal.prediction_set_generator - INFO -   Aggregation: separate
2025-12-07 17:49:50 - src.conformal.prediction_set_generator - INFO - Calibrating 1 conformal predictors...
2025-12-07 17:49:50 - src.conformal.prediction_set_generator - INFO -   Calibrating LAC...
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO - Calibrating with 4998 samples...
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO - Calibration complete
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO -   Threshold: 0.9796
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO -   Score range: [0.0004, 1.0000]
2025-12-07 17:49:50 - src.conformal.prediction_set_generator - INFO - Calibration complete
2025-12-07 17:49:50 - src.conformal.prediction_set_generator - INFO - Generating prediction sets using LAC...
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO - Generating prediction sets for 5002 test instances...
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO - Prediction complete
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO -   Average set size: 5.21
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO -   Coverage rate: 89.94%
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO -   Meets coverage guarantee: False
2025-12-07 17:49:50 - src.conformal.conformal_base - WARNING - ✗ Coverage guarantee NOT met: 89.94% < 90.00%
2025-12-07 17:49:50 - src.conformal.prediction_set_generator - WARNING - LAC does not meet coverage guarantee: 89.94% < 90.00%
2025-12-07 17:49:50 - __main__ - INFO -     LAC: Acc=23.29%, CR=89.94%, SS=5.21
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO - Initialized APSScorer
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO -   Alpha: 0.1
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO -   Target coverage: 90.0%
2025-12-07 17:49:50 - src.conformal.scorers - INFO - Initialized APS (Adaptive Prediction Sets) scorer
2025-12-07 17:49:50 - src.conformal.prediction_set_generator - INFO - Initialized PredictionSetGenerator
2025-12-07 17:49:50 - src.conformal.prediction_set_generator - INFO -   Methods: ['aps']
2025-12-07 17:49:50 - src.conformal.prediction_set_generator - INFO -   Alpha: 0.1
2025-12-07 17:49:50 - src.conformal.prediction_set_generator - INFO -   Aggregation: separate
2025-12-07 17:49:50 - src.conformal.prediction_set_generator - INFO - Calibrating 1 conformal predictors...
2025-12-07 17:49:50 - src.conformal.prediction_set_generator - INFO -   Calibrating APS...
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO - Calibrating with 4998 samples...
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO - Calibration complete
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO -   Threshold: 1.0000
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO -   Score range: [0.2165, 1.0000]
2025-12-07 17:49:50 - src.conformal.prediction_set_generator - INFO - Calibration complete
2025-12-07 17:49:50 - src.conformal.prediction_set_generator - INFO - Generating prediction sets using APS...
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO - Generating prediction sets for 5002 test instances...
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO - Prediction complete
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO -   Average set size: 5.98
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO -   Coverage rate: 99.80%
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO -   Meets coverage guarantee: True
2025-12-07 17:49:50 - src.conformal.conformal_base - INFO - [PASS] Coverage guarantee met: 99.80% >= 90.00%
2025-12-07 17:49:50 - __main__ - INFO -     APS: Acc=23.29%, CR=99.80%, SS=5.98
2025-12-07 17:50:05 - src.models.model_loader - INFO - Unloaded model: phi-2_float16
2025-12-07 17:50:05 - __main__ - INFO - Checkpoint saved after completing: phi-2 | qa | float16
2025-12-07 17:50:05 - __main__ - INFO - 
================================================================================
2025-12-07 17:50:05 - __main__ - INFO - Run 2/5: phi-2 | rc | float16
2025-12-07 17:50:05 - __main__ - INFO - ================================================================================
2025-12-07 17:50:05 - src.utils.gpu - INFO - [start_phi-2_rc] GPU State: Allocated: 9.1MB | Reserved: 22.0MB | Free: 81143.6MB | Utilization: 0.0%
2025-12-07 17:50:05 - __main__ - INFO - Loading rc dataset (10000 samples)...
2025-12-07 17:50:05 - src.data.dataset_loader - INFO - Loading CosmosQA dataset with 10000 samples...
2025-12-07 17:52:02 - src.data.dataset_loader - INFO - CosmosQA loaded successfully with standard method
2025-12-07 17:52:03 - src.data.dataset_loader - INFO - Loaded 10000 CosmosQA instances
2025-12-07 17:52:03 - src.utils.gpu - INFO - [dataset_loading] Duration: 118285.35ms | GPU Memory: 9.1MB -> 9.1MB (delta +0.0MB)
2025-12-07 17:52:03 - src.data.dataset_processor - INFO - Processing rc dataset to 6-option format...
2025-12-07 17:52:04 - src.data.dataset_processor - INFO - Processed 10000 instances for rc
2025-12-07 17:52:04 - src.data.data_splitter - INFO - Splitting rc dataset (calibration: 50%, test: 50%)
2025-12-07 17:52:04 - src.data.data_splitter - INFO - Split complete:
2025-12-07 17:52:04 - src.data.data_splitter - INFO -   Calibration: 4999 instances
2025-12-07 17:52:04 - src.data.data_splitter - INFO -   Test: 5001 instances
2025-12-07 17:52:04 - src.data.data_splitter - INFO - Answer distribution:
2025-12-07 17:52:04 - src.data.data_splitter - INFO -   Calibration: {'A': 1240, 'B': 1245, 'C': 1263, 'D': 1251}
2025-12-07 17:52:04 - src.data.data_splitter - INFO -   Test: {'A': 1241, 'B': 1245, 'C': 1264, 'D': 1251}
2025-12-07 17:52:04 - src.utils.gpu - INFO - [dataset_processing] Duration: 49.71ms | GPU Memory: 9.1MB -> 9.1MB (delta +0.0MB)
2025-12-07 17:52:04 - src.prompting.demonstration_manager - INFO - Initialized DemonstrationSelector
2025-12-07 17:52:04 - src.prompting.demonstration_manager - INFO -   Strategy: random
2025-12-07 17:52:04 - src.prompting.demonstration_manager - INFO -   Num demonstrations: 5
2025-12-07 17:52:04 - src.prompting.demonstration_manager - INFO - Initialized DemonstrationManager
2025-12-07 17:52:04 - src.prompting.demonstration_manager - INFO - Selecting 5 demonstrations using 'random' strategy
2025-12-07 17:52:04 - src.prompting.demonstration_manager - INFO - Selected and cached 5 demonstrations for rc
2025-12-07 17:52:04 - __main__ - INFO - Loading model: phi-2 (float16)
2025-12-07 17:52:04 - src.models.model_loader - INFO - Loading model: phi-2_float16 (microsoft/phi-2)
2025-12-07 17:52:04 - src.models.model_loader - INFO - Loading tokenizer from microsoft/phi-2
2025-12-07 17:52:04 - src.models.model_loader - INFO - Tokenizer loaded successfully
2025-12-07 17:52:04 - src.models.model_loader - INFO -   Vocab size: 50295
2025-12-07 17:52:04 - src.models.model_loader - INFO -   Padding side: left
2025-12-07 17:52:04 - src.models.model_loader - INFO -   PAD token: <|endoftext|> (ID: 50256)
2025-12-07 17:52:04 - src.models.model_loader - INFO - Loading model from microsoft/phi-2
2025-12-07 17:52:04 - accelerate.utils.modeling - INFO - We will use 90% of the memory on device 0 for storing the model, and 10% for the buffer to avoid OOM. You can set `max_memory` in to a higher value to use more memory (at your own risk).
2025-12-07 17:52:11 - src.models.model_loader - INFO - Model loaded successfully
2025-12-07 17:52:11 - src.models.model_loader - INFO -   GPU Memory: 5.19GB allocated, 5.21GB reserved
2025-12-07 17:52:11 - src.utils.gpu - INFO - [model_loading] Duration: 7333.83ms | GPU Memory: 9.1MB -> 5311.0MB (delta +5301.8MB)
2025-12-07 17:52:11 - src.utils.gpu - INFO - [after_model_load_phi-2] GPU State: Allocated: 5311.0MB | Reserved: 5334.0MB | Free: 75841.8MB | Utilization: 100.0%
2025-12-07 17:52:11 - src.utils.gpu - INFO - Optimal batch size for 2.7B model (float16): 31
  Available memory: 73.70GB
  Model memory: 5.40GB
  Memory per batch item: 2.160GB
2025-12-07 17:52:11 - __main__ - INFO - Using batch size: 31
2025-12-07 17:52:11 - __main__ - INFO -   Strategy: base
2025-12-07 17:52:11 - src.prompting.prompt_builder - INFO - Initialized PromptBuilder for task: rc
2025-12-07 17:52:11 - src.prompting.prompt_builder - INFO -   Available strategies: ['base', 'shared_instruction', 'task_specific']
2025-12-07 17:52:11 - src.prompting.prompt_builder - INFO - Building 10000 prompts using 'base' strategy with 5 demonstrations
2025-12-07 17:52:11 - src.models.inference_engine - INFO - Initialized InferenceEngine for phi-2_float16
2025-12-07 17:52:11 - src.models.inference_engine - INFO -   Device: cuda:0
2025-12-07 17:52:11 - src.models.inference_engine - INFO -   Batch size: 31
2025-12-07 17:52:11 - src.models.inference_engine - INFO -   Option tokens: {'A': 32, 'B': 33, 'C': 34, 'D': 35, 'E': 36, 'F': 37}
2025-12-07 18:00:49 - src.utils.gpu - INFO - [inference_calibration] Duration: 518224.37ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 18:09:56 - src.utils.gpu - INFO - [inference_test] Duration: 546300.39ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 18:09:56 - __main__ - INFO -     Inference: 1064.53s for 10000 samples (9.39 samples/sec)
2025-12-07 18:09:56 - src.models.probability_extractor - INFO - Initialized ProbabilityExtractor
2025-12-07 18:09:56 - src.models.probability_extractor - INFO -   Temperature: 1.0
2025-12-07 18:09:56 - src.models.probability_extractor - INFO -   Calibration method: None
2025-12-07 18:09:56 - src.utils.gpu - INFO - [probability_extraction] Duration: 483.49ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO - Initialized LACScorer
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO -   Alpha: 0.1
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO -   Target coverage: 90.0%
2025-12-07 18:09:56 - src.conformal.scorers - INFO - Initialized LAC (Least Ambiguous set-valued Classifiers) scorer
2025-12-07 18:09:56 - src.conformal.prediction_set_generator - INFO - Initialized PredictionSetGenerator
2025-12-07 18:09:56 - src.conformal.prediction_set_generator - INFO -   Methods: ['lac']
2025-12-07 18:09:56 - src.conformal.prediction_set_generator - INFO -   Alpha: 0.1
2025-12-07 18:09:56 - src.conformal.prediction_set_generator - INFO -   Aggregation: separate
2025-12-07 18:09:56 - src.conformal.prediction_set_generator - INFO - Calibrating 1 conformal predictors...
2025-12-07 18:09:56 - src.conformal.prediction_set_generator - INFO -   Calibrating LAC...
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO - Calibrating with 4999 samples...
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO - Calibration complete
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO -   Threshold: 0.9737
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO -   Score range: [0.0004, 1.0000]
2025-12-07 18:09:56 - src.conformal.prediction_set_generator - INFO - Calibration complete
2025-12-07 18:09:56 - src.conformal.prediction_set_generator - INFO - Generating prediction sets using LAC...
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO - Generating prediction sets for 5001 test instances...
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO - Prediction complete
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO -   Average set size: 5.17
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO -   Coverage rate: 90.40%
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO -   Meets coverage guarantee: True
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO - [PASS] Coverage guarantee met: 90.40% >= 90.00%
2025-12-07 18:09:56 - __main__ - INFO -     LAC: Acc=25.45%, CR=90.40%, SS=5.17
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO - Initialized APSScorer
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO -   Alpha: 0.1
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO -   Target coverage: 90.0%
2025-12-07 18:09:56 - src.conformal.scorers - INFO - Initialized APS (Adaptive Prediction Sets) scorer
2025-12-07 18:09:56 - src.conformal.prediction_set_generator - INFO - Initialized PredictionSetGenerator
2025-12-07 18:09:56 - src.conformal.prediction_set_generator - INFO -   Methods: ['aps']
2025-12-07 18:09:56 - src.conformal.prediction_set_generator - INFO -   Alpha: 0.1
2025-12-07 18:09:56 - src.conformal.prediction_set_generator - INFO -   Aggregation: separate
2025-12-07 18:09:56 - src.conformal.prediction_set_generator - INFO - Calibrating 1 conformal predictors...
2025-12-07 18:09:56 - src.conformal.prediction_set_generator - INFO -   Calibrating APS...
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO - Calibrating with 4999 samples...
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO - Calibration complete
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO -   Threshold: 1.0000
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO -   Score range: [0.1931, 1.0000]
2025-12-07 18:09:56 - src.conformal.prediction_set_generator - INFO - Calibration complete
2025-12-07 18:09:56 - src.conformal.prediction_set_generator - INFO - Generating prediction sets using APS...
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO - Generating prediction sets for 5001 test instances...
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO - Prediction complete
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO -   Average set size: 5.99
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO -   Coverage rate: 99.82%
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO -   Meets coverage guarantee: True
2025-12-07 18:09:56 - src.conformal.conformal_base - INFO - [PASS] Coverage guarantee met: 99.82% >= 90.00%
2025-12-07 18:09:56 - __main__ - INFO -     APS: Acc=25.45%, CR=99.82%, SS=5.99
2025-12-07 18:10:07 - src.models.model_loader - INFO - Unloaded model: phi-2_float16
2025-12-07 18:10:07 - __main__ - INFO - Checkpoint saved after completing: phi-2 | rc | float16
2025-12-07 18:10:07 - __main__ - INFO - 
================================================================================
2025-12-07 18:10:07 - __main__ - INFO - Run 3/5: phi-2 | ci | float16
2025-12-07 18:10:07 - __main__ - INFO - ================================================================================
2025-12-07 18:10:08 - src.utils.gpu - INFO - [start_phi-2_ci] GPU State: Allocated: 9.1MB | Reserved: 22.0MB | Free: 81143.6MB | Utilization: 100.0%
2025-12-07 18:10:08 - __main__ - INFO - Loading ci dataset (10000 samples)...
2025-12-07 18:10:08 - src.data.dataset_loader - INFO - Loading HellaSwag dataset with 10000 samples...
2025-12-07 18:10:26 - src.data.dataset_loader - INFO - Loaded 10000 HellaSwag instances
2025-12-07 18:10:26 - src.utils.gpu - INFO - [dataset_loading] Duration: 18361.96ms | GPU Memory: 9.1MB -> 9.1MB (delta +0.0MB)
2025-12-07 18:10:26 - src.data.dataset_processor - INFO - Processing ci dataset to 6-option format...
2025-12-07 18:10:26 - src.data.dataset_processor - INFO - Processed 10000 instances for ci
2025-12-07 18:10:26 - src.data.data_splitter - INFO - Splitting ci dataset (calibration: 50%, test: 50%)
2025-12-07 18:10:26 - src.data.data_splitter - INFO - Split complete:
2025-12-07 18:10:26 - src.data.data_splitter - INFO -   Calibration: 4999 instances
2025-12-07 18:10:26 - src.data.data_splitter - INFO -   Test: 5001 instances
2025-12-07 18:10:26 - src.data.data_splitter - INFO - Answer distribution:
2025-12-07 18:10:26 - src.data.data_splitter - INFO -   Calibration: {'A': 1240, 'B': 1242, 'C': 1256, 'D': 1261}
2025-12-07 18:10:26 - src.data.data_splitter - INFO -   Test: {'A': 1240, 'B': 1242, 'C': 1257, 'D': 1262}
2025-12-07 18:10:26 - src.utils.gpu - INFO - [dataset_processing] Duration: 51.36ms | GPU Memory: 9.1MB -> 9.1MB (delta +0.0MB)
2025-12-07 18:10:26 - src.prompting.demonstration_manager - INFO - Initialized DemonstrationSelector
2025-12-07 18:10:26 - src.prompting.demonstration_manager - INFO -   Strategy: random
2025-12-07 18:10:26 - src.prompting.demonstration_manager - INFO -   Num demonstrations: 5
2025-12-07 18:10:26 - src.prompting.demonstration_manager - INFO - Initialized DemonstrationManager
2025-12-07 18:10:26 - src.prompting.demonstration_manager - INFO - Selecting 5 demonstrations using 'random' strategy
2025-12-07 18:10:26 - src.prompting.demonstration_manager - INFO - Selected and cached 5 demonstrations for ci
2025-12-07 18:10:26 - __main__ - INFO - Loading model: phi-2 (float16)
2025-12-07 18:10:26 - src.models.model_loader - INFO - Loading model: phi-2_float16 (microsoft/phi-2)
2025-12-07 18:10:26 - src.models.model_loader - INFO - Loading tokenizer from microsoft/phi-2
2025-12-07 18:10:26 - src.models.model_loader - INFO - Tokenizer loaded successfully
2025-12-07 18:10:26 - src.models.model_loader - INFO -   Vocab size: 50295
2025-12-07 18:10:26 - src.models.model_loader - INFO -   Padding side: left
2025-12-07 18:10:26 - src.models.model_loader - INFO -   PAD token: <|endoftext|> (ID: 50256)
2025-12-07 18:10:26 - src.models.model_loader - INFO - Loading model from microsoft/phi-2
2025-12-07 18:10:27 - accelerate.utils.modeling - INFO - We will use 90% of the memory on device 0 for storing the model, and 10% for the buffer to avoid OOM. You can set `max_memory` in to a higher value to use more memory (at your own risk).
2025-12-07 18:10:33 - src.models.model_loader - INFO - Model loaded successfully
2025-12-07 18:10:33 - src.models.model_loader - INFO -   GPU Memory: 5.19GB allocated, 5.21GB reserved
2025-12-07 18:10:33 - src.utils.gpu - INFO - [model_loading] Duration: 7215.09ms | GPU Memory: 9.1MB -> 5311.0MB (delta +5301.8MB)
2025-12-07 18:10:33 - src.utils.gpu - INFO - [after_model_load_phi-2] GPU State: Allocated: 5311.0MB | Reserved: 5334.0MB | Free: 75841.8MB | Utilization: 100.0%
2025-12-07 18:10:33 - src.utils.gpu - INFO - Optimal batch size for 2.7B model (float16): 31
  Available memory: 73.70GB
  Model memory: 5.40GB
  Memory per batch item: 2.160GB
2025-12-07 18:10:33 - __main__ - INFO - Using batch size: 31
2025-12-07 18:10:33 - __main__ - INFO -   Strategy: base
2025-12-07 18:10:33 - src.prompting.prompt_builder - INFO - Initialized PromptBuilder for task: ci
2025-12-07 18:10:33 - src.prompting.prompt_builder - INFO -   Available strategies: ['base', 'shared_instruction', 'task_specific']
2025-12-07 18:10:33 - src.prompting.prompt_builder - INFO - Building 10000 prompts using 'base' strategy with 5 demonstrations
2025-12-07 18:10:34 - src.models.inference_engine - INFO - Initialized InferenceEngine for phi-2_float16
2025-12-07 18:10:34 - src.models.inference_engine - INFO -   Device: cuda:0
2025-12-07 18:10:34 - src.models.inference_engine - INFO -   Batch size: 31
2025-12-07 18:10:34 - src.models.inference_engine - INFO -   Option tokens: {'A': 32, 'B': 33, 'C': 34, 'D': 35, 'E': 36, 'F': 37}
2025-12-07 18:21:03 - src.utils.gpu - INFO - [inference_calibration] Duration: 629291.31ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 18:27:14 - src.utils.gpu - INFO - [inference_test] Duration: 371177.08ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 18:27:14 - __main__ - INFO -     Inference: 1000.47s for 10000 samples (10.00 samples/sec)
2025-12-07 18:27:14 - src.models.probability_extractor - INFO - Initialized ProbabilityExtractor
2025-12-07 18:27:14 - src.models.probability_extractor - INFO -   Temperature: 1.0
2025-12-07 18:27:14 - src.models.probability_extractor - INFO -   Calibration method: None
2025-12-07 18:27:14 - src.utils.gpu - INFO - [probability_extraction] Duration: 417.86ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 18:27:14 - src.conformal.conformal_base - INFO - Initialized LACScorer
2025-12-07 18:27:14 - src.conformal.conformal_base - INFO -   Alpha: 0.1
2025-12-07 18:27:14 - src.conformal.conformal_base - INFO -   Target coverage: 90.0%
2025-12-07 18:27:14 - src.conformal.scorers - INFO - Initialized LAC (Least Ambiguous set-valued Classifiers) scorer
2025-12-07 18:27:14 - src.conformal.prediction_set_generator - INFO - Initialized PredictionSetGenerator
2025-12-07 18:27:14 - src.conformal.prediction_set_generator - INFO -   Methods: ['lac']
2025-12-07 18:27:14 - src.conformal.prediction_set_generator - INFO -   Alpha: 0.1
2025-12-07 18:27:14 - src.conformal.prediction_set_generator - INFO -   Aggregation: separate
2025-12-07 18:27:14 - src.conformal.prediction_set_generator - INFO - Calibrating 1 conformal predictors...
2025-12-07 18:27:14 - src.conformal.prediction_set_generator - INFO -   Calibrating LAC...
2025-12-07 18:27:14 - src.conformal.conformal_base - INFO - Calibrating with 4999 samples...
2025-12-07 18:27:14 - src.conformal.conformal_base - INFO - Calibration complete
2025-12-07 18:27:14 - src.conformal.conformal_base - INFO -   Threshold: 0.9742
2025-12-07 18:27:14 - src.conformal.conformal_base - INFO -   Score range: [0.0005, 1.0000]
2025-12-07 18:27:14 - src.conformal.prediction_set_generator - INFO - Calibration complete
2025-12-07 18:27:14 - src.conformal.prediction_set_generator - INFO - Generating prediction sets using LAC...
2025-12-07 18:27:14 - src.conformal.conformal_base - INFO - Generating prediction sets for 5001 test instances...
2025-12-07 18:27:14 - src.conformal.conformal_base - INFO - Prediction complete
2025-12-07 18:27:14 - src.conformal.conformal_base - INFO -   Average set size: 5.09
2025-12-07 18:27:14 - src.conformal.conformal_base - INFO -   Coverage rate: 88.92%
2025-12-07 18:27:14 - src.conformal.conformal_base - INFO -   Meets coverage guarantee: False
2025-12-07 18:27:14 - src.conformal.conformal_base - WARNING - ✗ Coverage guarantee NOT met: 88.92% < 90.00%
2025-12-07 18:27:14 - src.conformal.prediction_set_generator - WARNING - LAC does not meet coverage guarantee: 88.92% < 90.00%
2025-12-07 18:27:14 - __main__ - INFO -     LAC: Acc=22.30%, CR=88.92%, SS=5.09
2025-12-07 18:27:14 - src.conformal.conformal_base - INFO - Initialized APSScorer
2025-12-07 18:27:14 - src.conformal.conformal_base - INFO -   Alpha: 0.1
2025-12-07 18:27:14 - src.conformal.conformal_base - INFO -   Target coverage: 90.0%
2025-12-07 18:27:14 - src.conformal.scorers - INFO - Initialized APS (Adaptive Prediction Sets) scorer
2025-12-07 18:27:14 - src.conformal.prediction_set_generator - INFO - Initialized PredictionSetGenerator
2025-12-07 18:27:14 - src.conformal.prediction_set_generator - INFO -   Methods: ['aps']
2025-12-07 18:27:14 - src.conformal.prediction_set_generator - INFO -   Alpha: 0.1
2025-12-07 18:27:14 - src.conformal.prediction_set_generator - INFO -   Aggregation: separate
2025-12-07 18:27:14 - src.conformal.prediction_set_generator - INFO - Calibrating 1 conformal predictors...
2025-12-07 18:27:14 - src.conformal.prediction_set_generator - INFO -   Calibrating APS...
2025-12-07 18:27:14 - src.conformal.conformal_base - INFO - Calibrating with 4999 samples...
2025-12-07 18:27:14 - src.conformal.conformal_base - INFO - Calibration complete
2025-12-07 18:27:14 - src.conformal.conformal_base - INFO -   Threshold: 1.0000
2025-12-07 18:27:14 - src.conformal.conformal_base - INFO -   Score range: [0.2077, 1.0000]
2025-12-07 18:27:14 - src.conformal.prediction_set_generator - INFO - Calibration complete
2025-12-07 18:27:14 - src.conformal.prediction_set_generator - INFO - Generating prediction sets using APS...
2025-12-07 18:27:14 - src.conformal.conformal_base - INFO - Generating prediction sets for 5001 test instances...
2025-12-07 18:27:15 - src.conformal.conformal_base - INFO - Prediction complete
2025-12-07 18:27:15 - src.conformal.conformal_base - INFO -   Average set size: 5.95
2025-12-07 18:27:15 - src.conformal.conformal_base - INFO -   Coverage rate: 99.06%
2025-12-07 18:27:15 - src.conformal.conformal_base - INFO -   Meets coverage guarantee: True
2025-12-07 18:27:15 - src.conformal.conformal_base - INFO - [PASS] Coverage guarantee met: 99.06% >= 90.00%
2025-12-07 18:27:15 - __main__ - INFO -     APS: Acc=22.30%, CR=99.06%, SS=5.95
2025-12-07 18:27:24 - src.models.model_loader - INFO - Unloaded model: phi-2_float16
2025-12-07 18:27:24 - __main__ - INFO - Checkpoint saved after completing: phi-2 | ci | float16
2025-12-07 18:27:24 - __main__ - INFO - 
================================================================================
2025-12-07 18:27:24 - __main__ - INFO - Run 4/5: phi-2 | drs | float16
2025-12-07 18:27:24 - __main__ - INFO - ================================================================================
2025-12-07 18:27:24 - src.utils.gpu - INFO - [start_phi-2_drs] GPU State: Allocated: 9.1MB | Reserved: 22.0MB | Free: 81143.6MB | Utilization: 2.0%
2025-12-07 18:27:24 - __main__ - INFO - Loading drs dataset (10000 samples)...
2025-12-07 18:27:24 - src.data.dataset_loader - INFO - Loading HaluDial dataset with 10000 samples...
2025-12-07 18:27:25 - src.data.dataset_loader - INFO - Loaded 10000 HaluDial instances
2025-12-07 18:27:25 - src.utils.gpu - INFO - [dataset_loading] Duration: 1496.46ms | GPU Memory: 9.1MB -> 9.1MB (delta +0.0MB)
2025-12-07 18:27:25 - src.data.dataset_processor - INFO - Processing drs dataset to 6-option format...
2025-12-07 18:27:58 - src.data.dataset_processor - INFO - Processed 10000 instances for drs
2025-12-07 18:27:58 - src.data.dataset_processor - INFO - Option expansion statistics for drs:
2025-12-07 18:27:58 - src.data.dataset_processor - INFO -   Instances expanded (2→4 options): 10000
2025-12-07 18:27:58 - src.data.dataset_processor - INFO -   Total options sampled: 20000
2025-12-07 18:27:58 - src.data.dataset_processor - INFO -   Duplicate options avoided: 2
2025-12-07 18:27:58 - src.data.dataset_processor - INFO -   Fallback options used: 0
2025-12-07 18:27:58 - src.data.data_splitter - INFO - Splitting drs dataset (calibration: 50%, test: 50%)
2025-12-07 18:27:58 - src.data.data_splitter - INFO - Split complete:
2025-12-07 18:27:58 - src.data.data_splitter - INFO -   Calibration: 4999 instances
2025-12-07 18:27:58 - src.data.data_splitter - INFO -   Test: 5001 instances
2025-12-07 18:27:58 - src.data.data_splitter - INFO - Answer distribution:
2025-12-07 18:27:58 - src.data.data_splitter - INFO -   Calibration: {'A': 1258, 'B': 1203, 'C': 1264, 'D': 1274}
2025-12-07 18:27:58 - src.data.data_splitter - INFO -   Test: {'A': 1258, 'B': 1204, 'C': 1265, 'D': 1274}
2025-12-07 18:27:58 - src.utils.gpu - INFO - [dataset_processing] Duration: 32653.72ms | GPU Memory: 9.1MB -> 9.1MB (delta +0.0MB)
2025-12-07 18:27:58 - src.prompting.demonstration_manager - INFO - Initialized DemonstrationSelector
2025-12-07 18:27:58 - src.prompting.demonstration_manager - INFO -   Strategy: random
2025-12-07 18:27:58 - src.prompting.demonstration_manager - INFO -   Num demonstrations: 5
2025-12-07 18:27:58 - src.prompting.demonstration_manager - INFO - Initialized DemonstrationManager
2025-12-07 18:27:58 - src.prompting.demonstration_manager - INFO - Selecting 3 demonstrations using 'random' strategy
2025-12-07 18:27:58 - src.prompting.demonstration_manager - INFO - Selected and cached 3 demonstrations for drs
2025-12-07 18:27:58 - __main__ - INFO - Loading model: phi-2 (float16)
2025-12-07 18:27:58 - src.models.model_loader - INFO - Loading model: phi-2_float16 (microsoft/phi-2)
2025-12-07 18:27:58 - src.models.model_loader - INFO - Loading tokenizer from microsoft/phi-2
2025-12-07 18:27:58 - src.models.model_loader - INFO - Tokenizer loaded successfully
2025-12-07 18:27:58 - src.models.model_loader - INFO -   Vocab size: 50295
2025-12-07 18:27:58 - src.models.model_loader - INFO -   Padding side: left
2025-12-07 18:27:58 - src.models.model_loader - INFO -   PAD token: <|endoftext|> (ID: 50256)
2025-12-07 18:27:58 - src.models.model_loader - INFO - Loading model from microsoft/phi-2
2025-12-07 18:27:58 - accelerate.utils.modeling - INFO - We will use 90% of the memory on device 0 for storing the model, and 10% for the buffer to avoid OOM. You can set `max_memory` in to a higher value to use more memory (at your own risk).
2025-12-07 18:28:04 - src.models.model_loader - INFO - Model loaded successfully
2025-12-07 18:28:04 - src.models.model_loader - INFO -   GPU Memory: 5.19GB allocated, 5.21GB reserved
2025-12-07 18:28:04 - src.utils.gpu - INFO - [model_loading] Duration: 5666.30ms | GPU Memory: 9.1MB -> 5311.0MB (delta +5301.8MB)
2025-12-07 18:28:04 - src.utils.gpu - INFO - [after_model_load_phi-2] GPU State: Allocated: 5311.0MB | Reserved: 5334.0MB | Free: 75841.8MB | Utilization: 3.0%
2025-12-07 18:28:04 - src.utils.gpu - INFO - Optimal batch size for 2.7B model (float16): 31
  Available memory: 73.70GB
  Model memory: 5.40GB
  Memory per batch item: 2.160GB
2025-12-07 18:28:04 - __main__ - INFO - Using batch size: 31
2025-12-07 18:28:04 - __main__ - INFO -   Strategy: base
2025-12-07 18:28:04 - src.prompting.prompt_builder - INFO - Initialized PromptBuilder for task: drs
2025-12-07 18:28:04 - src.prompting.prompt_builder - INFO -   Available strategies: ['base', 'shared_instruction', 'task_specific']
2025-12-07 18:28:04 - src.prompting.prompt_builder - INFO - Building 10000 prompts using 'base' strategy with 3 demonstrations
2025-12-07 18:28:04 - src.models.inference_engine - INFO - Initialized InferenceEngine for phi-2_float16
2025-12-07 18:28:04 - src.models.inference_engine - INFO -   Device: cuda:0
2025-12-07 18:28:04 - src.models.inference_engine - INFO -   Batch size: 31
2025-12-07 18:28:04 - src.models.inference_engine - INFO -   Option tokens: {'A': 32, 'B': 33, 'C': 34, 'D': 35, 'E': 36, 'F': 37}
2025-12-07 18:31:19 - src.utils.gpu - INFO - [inference_calibration] Duration: 195619.98ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 18:34:36 - src.utils.gpu - INFO - [inference_test] Duration: 197052.42ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 18:34:36 - __main__ - INFO -     Inference: 392.67s for 10000 samples (25.47 samples/sec)
2025-12-07 18:34:36 - src.models.probability_extractor - INFO - Initialized ProbabilityExtractor
2025-12-07 18:34:36 - src.models.probability_extractor - INFO -   Temperature: 1.0
2025-12-07 18:34:36 - src.models.probability_extractor - INFO -   Calibration method: None
2025-12-07 18:34:37 - src.utils.gpu - INFO - [probability_extraction] Duration: 205.25ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO - Initialized LACScorer
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO -   Alpha: 0.1
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO -   Target coverage: 90.0%
2025-12-07 18:34:37 - src.conformal.scorers - INFO - Initialized LAC (Least Ambiguous set-valued Classifiers) scorer
2025-12-07 18:34:37 - src.conformal.prediction_set_generator - INFO - Initialized PredictionSetGenerator
2025-12-07 18:34:37 - src.conformal.prediction_set_generator - INFO -   Methods: ['lac']
2025-12-07 18:34:37 - src.conformal.prediction_set_generator - INFO -   Alpha: 0.1
2025-12-07 18:34:37 - src.conformal.prediction_set_generator - INFO -   Aggregation: separate
2025-12-07 18:34:37 - src.conformal.prediction_set_generator - INFO - Calibrating 1 conformal predictors...
2025-12-07 18:34:37 - src.conformal.prediction_set_generator - INFO -   Calibrating LAC...
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO - Calibrating with 4999 samples...
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO - Calibration complete
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO -   Threshold: 0.9757
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO -   Score range: [0.0005, 1.0000]
2025-12-07 18:34:37 - src.conformal.prediction_set_generator - INFO - Calibration complete
2025-12-07 18:34:37 - src.conformal.prediction_set_generator - INFO - Generating prediction sets using LAC...
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO - Generating prediction sets for 5001 test instances...
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO - Prediction complete
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO -   Average set size: 5.24
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO -   Coverage rate: 89.62%
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO -   Meets coverage guarantee: False
2025-12-07 18:34:37 - src.conformal.conformal_base - WARNING - ✗ Coverage guarantee NOT met: 89.62% < 90.00%
2025-12-07 18:34:37 - src.conformal.prediction_set_generator - WARNING - LAC does not meet coverage guarantee: 89.62% < 90.00%
2025-12-07 18:34:37 - __main__ - INFO -     LAC: Acc=23.28%, CR=89.62%, SS=5.24
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO - Initialized APSScorer
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO -   Alpha: 0.1
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO -   Target coverage: 90.0%
2025-12-07 18:34:37 - src.conformal.scorers - INFO - Initialized APS (Adaptive Prediction Sets) scorer
2025-12-07 18:34:37 - src.conformal.prediction_set_generator - INFO - Initialized PredictionSetGenerator
2025-12-07 18:34:37 - src.conformal.prediction_set_generator - INFO -   Methods: ['aps']
2025-12-07 18:34:37 - src.conformal.prediction_set_generator - INFO -   Alpha: 0.1
2025-12-07 18:34:37 - src.conformal.prediction_set_generator - INFO -   Aggregation: separate
2025-12-07 18:34:37 - src.conformal.prediction_set_generator - INFO - Calibrating 1 conformal predictors...
2025-12-07 18:34:37 - src.conformal.prediction_set_generator - INFO -   Calibrating APS...
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO - Calibrating with 4999 samples...
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO - Calibration complete
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO -   Threshold: 0.9999
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO -   Score range: [0.2092, 1.0000]
2025-12-07 18:34:37 - src.conformal.prediction_set_generator - INFO - Calibration complete
2025-12-07 18:34:37 - src.conformal.prediction_set_generator - INFO - Generating prediction sets using APS...
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO - Generating prediction sets for 5001 test instances...
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO - Prediction complete
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO -   Average set size: 5.95
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO -   Coverage rate: 99.16%
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO -   Meets coverage guarantee: True
2025-12-07 18:34:37 - src.conformal.conformal_base - INFO - [PASS] Coverage guarantee met: 99.16% >= 90.00%
2025-12-07 18:34:37 - __main__ - INFO -     APS: Acc=23.28%, CR=99.16%, SS=5.95
2025-12-07 18:34:45 - src.models.model_loader - INFO - Unloaded model: phi-2_float16
2025-12-07 18:34:45 - __main__ - INFO - Checkpoint saved after completing: phi-2 | drs | float16
2025-12-07 18:34:45 - __main__ - INFO - 
================================================================================
2025-12-07 18:34:45 - __main__ - INFO - Run 5/5: phi-2 | ds | float16
2025-12-07 18:34:45 - __main__ - INFO - ================================================================================
2025-12-07 18:34:45 - src.utils.gpu - INFO - [start_phi-2_ds] GPU State: Allocated: 9.1MB | Reserved: 22.0MB | Free: 81143.6MB | Utilization: 5.0%
2025-12-07 18:34:45 - __main__ - INFO - Loading ds dataset (10000 samples)...
2025-12-07 18:34:45 - src.data.dataset_loader - INFO - Loading HaluSum dataset with 10000 samples...
2025-12-07 18:34:50 - src.data.dataset_loader - INFO - Loaded 10000 HaluSum instances
2025-12-07 18:34:50 - src.utils.gpu - INFO - [dataset_loading] Duration: 5663.18ms | GPU Memory: 9.1MB -> 9.1MB (delta +0.0MB)
2025-12-07 18:34:50 - src.data.dataset_processor - INFO - Processing ds dataset to 6-option format...
2025-12-07 18:35:26 - src.data.dataset_processor - INFO - Processed 10000 instances for ds
2025-12-07 18:35:26 - src.data.dataset_processor - INFO - Option expansion statistics for ds:
2025-12-07 18:35:26 - src.data.dataset_processor - INFO -   Instances expanded (2→4 options): 10000
2025-12-07 18:35:26 - src.data.dataset_processor - INFO -   Total options sampled: 20000
2025-12-07 18:35:26 - src.data.dataset_processor - INFO -   Duplicate options avoided: 0
2025-12-07 18:35:26 - src.data.dataset_processor - INFO -   Fallback options used: 0
2025-12-07 18:35:26 - src.data.data_splitter - INFO - Splitting ds dataset (calibration: 50%, test: 50%)
2025-12-07 18:35:26 - src.data.data_splitter - INFO - Split complete:
2025-12-07 18:35:26 - src.data.data_splitter - INFO -   Calibration: 4999 instances
2025-12-07 18:35:26 - src.data.data_splitter - INFO -   Test: 5001 instances
2025-12-07 18:35:26 - src.data.data_splitter - INFO - Answer distribution:
2025-12-07 18:35:26 - src.data.data_splitter - INFO -   Calibration: {'A': 1258, 'B': 1203, 'C': 1264, 'D': 1274}
2025-12-07 18:35:26 - src.data.data_splitter - INFO -   Test: {'A': 1258, 'B': 1204, 'C': 1265, 'D': 1274}
2025-12-07 18:35:26 - src.utils.gpu - INFO - [dataset_processing] Duration: 35372.91ms | GPU Memory: 9.1MB -> 9.1MB (delta +0.0MB)
2025-12-07 18:35:26 - src.prompting.demonstration_manager - INFO - Initialized DemonstrationSelector
2025-12-07 18:35:26 - src.prompting.demonstration_manager - INFO -   Strategy: random
2025-12-07 18:35:26 - src.prompting.demonstration_manager - INFO -   Num demonstrations: 5
2025-12-07 18:35:26 - src.prompting.demonstration_manager - INFO - Initialized DemonstrationManager
2025-12-07 18:35:26 - src.prompting.demonstration_manager - INFO - Selecting 1 demonstrations using 'random' strategy
2025-12-07 18:35:26 - src.prompting.demonstration_manager - INFO - Selected and cached 1 demonstrations for ds
2025-12-07 18:35:26 - __main__ - INFO - Loading model: phi-2 (float16)
2025-12-07 18:35:26 - src.models.model_loader - INFO - Loading model: phi-2_float16 (microsoft/phi-2)
2025-12-07 18:35:26 - src.models.model_loader - INFO - Loading tokenizer from microsoft/phi-2
2025-12-07 18:35:26 - src.models.model_loader - INFO - Tokenizer loaded successfully
2025-12-07 18:35:26 - src.models.model_loader - INFO -   Vocab size: 50295
2025-12-07 18:35:26 - src.models.model_loader - INFO -   Padding side: left
2025-12-07 18:35:26 - src.models.model_loader - INFO -   PAD token: <|endoftext|> (ID: 50256)
2025-12-07 18:35:26 - src.models.model_loader - INFO - Loading model from microsoft/phi-2
2025-12-07 18:35:26 - accelerate.utils.modeling - INFO - We will use 90% of the memory on device 0 for storing the model, and 10% for the buffer to avoid OOM. You can set `max_memory` in to a higher value to use more memory (at your own risk).
2025-12-07 18:35:31 - src.models.model_loader - INFO - Model loaded successfully
2025-12-07 18:35:31 - src.models.model_loader - INFO -   GPU Memory: 5.19GB allocated, 5.21GB reserved
2025-12-07 18:35:31 - src.utils.gpu - INFO - [model_loading] Duration: 5681.38ms | GPU Memory: 9.1MB -> 5311.0MB (delta +5301.8MB)
2025-12-07 18:35:31 - src.utils.gpu - INFO - [after_model_load_phi-2] GPU State: Allocated: 5311.0MB | Reserved: 5334.0MB | Free: 75841.8MB | Utilization: 4.0%
2025-12-07 18:35:31 - src.utils.gpu - INFO - Optimal batch size for 2.7B model (float16): 31
  Available memory: 73.70GB
  Model memory: 5.40GB
  Memory per batch item: 2.160GB
2025-12-07 18:35:31 - __main__ - INFO - Using batch size: 31
2025-12-07 18:35:31 - __main__ - INFO -   Strategy: base
2025-12-07 18:35:31 - src.prompting.prompt_builder - INFO - Initialized PromptBuilder for task: ds
2025-12-07 18:35:31 - src.prompting.prompt_builder - INFO -   Available strategies: ['base', 'shared_instruction', 'task_specific']
2025-12-07 18:35:31 - src.prompting.prompt_builder - INFO - Building 10000 prompts using 'base' strategy with 1 demonstrations
2025-12-07 18:35:32 - src.models.inference_engine - INFO - Initialized InferenceEngine for phi-2_float16
2025-12-07 18:35:32 - src.models.inference_engine - INFO -   Device: cuda:0
2025-12-07 18:35:32 - src.models.inference_engine - INFO -   Batch size: 31
2025-12-07 18:35:32 - src.models.inference_engine - INFO -   Option tokens: {'A': 32, 'B': 33, 'C': 34, 'D': 35, 'E': 36, 'F': 37}
2025-12-07 18:46:46 - src.utils.gpu - INFO - [inference_calibration] Duration: 674906.66ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 18:57:56 - src.utils.gpu - INFO - [inference_test] Duration: 669456.32ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 18:57:56 - __main__ - INFO -     Inference: 1344.37s for 10000 samples (7.44 samples/sec)
2025-12-07 18:57:56 - src.models.probability_extractor - INFO - Initialized ProbabilityExtractor
2025-12-07 18:57:56 - src.models.probability_extractor - INFO -   Temperature: 1.0
2025-12-07 18:57:56 - src.models.probability_extractor - INFO -   Calibration method: None
2025-12-07 18:57:56 - src.utils.gpu - INFO - [probability_extraction] Duration: 211.85ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO - Initialized LACScorer
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO -   Alpha: 0.1
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO -   Target coverage: 90.0%
2025-12-07 18:57:56 - src.conformal.scorers - INFO - Initialized LAC (Least Ambiguous set-valued Classifiers) scorer
2025-12-07 18:57:56 - src.conformal.prediction_set_generator - INFO - Initialized PredictionSetGenerator
2025-12-07 18:57:56 - src.conformal.prediction_set_generator - INFO -   Methods: ['lac']
2025-12-07 18:57:56 - src.conformal.prediction_set_generator - INFO -   Alpha: 0.1
2025-12-07 18:57:56 - src.conformal.prediction_set_generator - INFO -   Aggregation: separate
2025-12-07 18:57:56 - src.conformal.prediction_set_generator - INFO - Calibrating 1 conformal predictors...
2025-12-07 18:57:56 - src.conformal.prediction_set_generator - INFO -   Calibrating LAC...
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO - Calibrating with 4999 samples...
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO - Calibration complete
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO -   Threshold: 0.9583
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO -   Score range: [0.0011, 1.0000]
2025-12-07 18:57:56 - src.conformal.prediction_set_generator - INFO - Calibration complete
2025-12-07 18:57:56 - src.conformal.prediction_set_generator - INFO - Generating prediction sets using LAC...
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO - Generating prediction sets for 5001 test instances...
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO - Prediction complete
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO -   Average set size: 4.88
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO -   Coverage rate: 89.22%
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO -   Meets coverage guarantee: False
2025-12-07 18:57:56 - src.conformal.conformal_base - WARNING - ✗ Coverage guarantee NOT met: 89.22% < 90.00%
2025-12-07 18:57:56 - src.conformal.prediction_set_generator - WARNING - LAC does not meet coverage guarantee: 89.22% < 90.00%
2025-12-07 18:57:56 - __main__ - INFO -     LAC: Acc=38.31%, CR=89.22%, SS=4.88
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO - Initialized APSScorer
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO -   Alpha: 0.1
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO -   Target coverage: 90.0%
2025-12-07 18:57:56 - src.conformal.scorers - INFO - Initialized APS (Adaptive Prediction Sets) scorer
2025-12-07 18:57:56 - src.conformal.prediction_set_generator - INFO - Initialized PredictionSetGenerator
2025-12-07 18:57:56 - src.conformal.prediction_set_generator - INFO -   Methods: ['aps']
2025-12-07 18:57:56 - src.conformal.prediction_set_generator - INFO -   Alpha: 0.1
2025-12-07 18:57:56 - src.conformal.prediction_set_generator - INFO -   Aggregation: separate
2025-12-07 18:57:56 - src.conformal.prediction_set_generator - INFO - Calibrating 1 conformal predictors...
2025-12-07 18:57:56 - src.conformal.prediction_set_generator - INFO -   Calibrating APS...
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO - Calibrating with 4999 samples...
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO - Calibration complete
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO -   Threshold: 0.9873
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO -   Score range: [0.1994, 1.0000]
2025-12-07 18:57:56 - src.conformal.prediction_set_generator - INFO - Calibration complete
2025-12-07 18:57:56 - src.conformal.prediction_set_generator - INFO - Generating prediction sets using APS...
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO - Generating prediction sets for 5001 test instances...
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO - Prediction complete
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO -   Average set size: 5.74
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO -   Coverage rate: 97.36%
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO -   Meets coverage guarantee: True
2025-12-07 18:57:56 - src.conformal.conformal_base - INFO - [PASS] Coverage guarantee met: 97.36% >= 90.00%
2025-12-07 18:57:56 - __main__ - INFO -     APS: Acc=38.31%, CR=97.36%, SS=5.74
2025-12-07 18:58:05 - src.models.model_loader - INFO - Unloaded model: phi-2_float16
2025-12-07 18:58:05 - __main__ - INFO - Checkpoint saved after completing: phi-2 | ds | float16
2025-12-07 18:58:05 - src.visualization.result_visualizer - INFO - Generating all visualizations...
2025-12-07 18:58:06 - src.visualization.result_visualizer - INFO - Saved heatmap to outputs/results/figures/heatmap_accuracy.png
2025-12-07 18:58:06 - src.visualization.result_visualizer - INFO - Saved heatmap to outputs/results/figures/heatmap_coverage_rate.png
2025-12-07 18:58:06 - src.visualization.result_visualizer - INFO - Saved heatmap to outputs/results/figures/heatmap_avg_set_size.png
2025-12-07 18:58:08 - src.visualization.result_visualizer - INFO - Saved dashboard to outputs/results/figures/dashboard.png
2025-12-07 18:58:08 - src.visualization.result_visualizer - INFO - Saved bar chart to outputs/results/figures/bar_comparison_accuracy.png
2025-12-07 18:58:08 - src.visualization.result_visualizer - INFO - Saved bar chart to outputs/results/figures/bar_comparison_avg_set_size.png
2025-12-07 18:58:09 - src.visualization.result_visualizer - INFO - Saved radar chart to outputs/results/figures/radar_chart.png
2025-12-07 18:58:10 - src.visualization.result_visualizer - INFO - Saved uncertainty analysis to outputs/results/figures/uncertainty_analysis.png
2025-12-07 18:58:10 - src.visualization.result_visualizer - INFO - Saved summary table to outputs/results/figures/results_summary.md
2025-12-07 18:58:10 - src.visualization.result_visualizer - INFO - Saved summary table to outputs/results/figures/results_summary_lac.md
2025-12-07 18:58:10 - src.visualization.result_visualizer - INFO - Saved summary table to outputs/results/figures/results_summary_aps.md
2025-12-07 18:58:10 - src.visualization.result_visualizer - INFO - All visualizations saved to outputs/results/figures
2025-12-07 18:58:10 - __main__ - INFO - Visualizations saved to: outputs/results/figures
2025-12-07 18:58:11 - src.utils.gpu - INFO - Stopped GPU monitoring. Collected 1630 snapshots.
2025-12-07 18:58:11 - src.utils.gpu - INFO - Saved GPU profiling report to outputs/results/gpu_profile_20251207_173044.json
2025-12-07 18:58:11 - __main__ - INFO - GPU profiling report saved to: outputs/results/gpu_profile_20251207_173044.json
2025-12-07 18:58:11 - __main__ - INFO - 
================================================================================
2025-12-07 18:58:11 - __main__ - INFO - BENCHMARK COMPLETE
2025-12-07 18:58:11 - __main__ - INFO - ================================================================================
2025-12-07 18:58:11 - __main__ - INFO - Total time: 87.22 minutes
2025-12-07 18:58:11 - __main__ - INFO - Results saved to: outputs/results
2025-12-07 18:58:11 - __main__ - INFO - Benchmark completed successfully
2025-12-07 18:58:11 - __main__ - INFO - Total runs: 10
2025-12-07 18:58:11 - __main__ - INFO - Overall accuracy: 26.53%
2025-12-07 18:58:11 - __main__ - INFO - Overall coverage: 94.33%
2025-12-07 18:58:11 - __main__ - INFO - Log file saved to: outputs/results/logs/benchmark_20251207_173044.log
