2025-12-07 23:19:38 - __main__ - INFO - Starting benchmark run
2025-12-07 23:19:38 - __main__ - INFO - Log file: outputs/results/logs/benchmark_20251207_231938.log
2025-12-07 23:19:38 - __main__ - INFO - Mode: long, Samples: 10000
2025-12-07 23:19:38 - __main__ - INFO - Models: ['phi-2']
2025-12-07 23:19:38 - __main__ - INFO - Tasks: ['qa', 'rc', 'ci', 'drs', 'ds']
2025-12-07 23:19:38 - __main__ - INFO - Dtypes: ['float16']
2025-12-07 23:19:40 - __main__ - INFO - Running on: Device: NVIDIA A100 80GB PCIe (cuda)
  Total Memory: 79.25 GB
  Available Memory: 79.25 GB
2025-12-07 23:19:40 - src.utils.gpu - INFO - Detected A100 GPU: NVIDIA A100 80GB PCIe - using optimized A100 settings
2025-12-07 23:19:40 - __main__ - INFO - GPU Tier: a100 | Auto max_batch_size: 192 | Safety margin: 0.93
2025-12-07 23:19:40 - __main__ - INFO - Using user-specified max_batch_size: 32
2025-12-07 23:19:40 - src.utils.gpu - INFO - NVML initialized for GPU utilization monitoring
2025-12-07 23:19:40 - src.utils.gpu - INFO - GPUProfiler initialized (CUDA: True, NVML: True)
2025-12-07 23:19:40 - src.utils.gpu - INFO - Started GPU monitoring
2025-12-07 23:19:40 - __main__ - INFO - GPU profiling enabled
2025-12-07 23:19:40 - __main__ - INFO - 
================================================================================
2025-12-07 23:19:40 - __main__ - INFO - FULL BENCHMARK CONFIGURATION
2025-12-07 23:19:40 - __main__ - INFO - ================================================================================
2025-12-07 23:19:40 - __main__ - INFO - Models (1): ['phi-2']
2025-12-07 23:19:40 - __main__ - INFO - Tasks (5): ['qa', 'rc', 'ci', 'drs', 'ds']
2025-12-07 23:19:40 - __main__ - INFO - Data types: ['float16']
2025-12-07 23:19:40 - __main__ - INFO - Samples per task: 10000
2025-12-07 23:19:40 - __main__ - INFO - Alpha (error rate): 0.1
2025-12-07 23:19:40 - __main__ - INFO - Strategies: ['base']
2025-12-07 23:19:40 - __main__ - INFO - Conformal methods: ['lac', 'aps']
2025-12-07 23:19:40 - __main__ - INFO - Dynamic batch sizing: False
2025-12-07 23:19:40 - __main__ - INFO - Max batch size: 32 (GPU tier: a100)
2025-12-07 23:19:40 - __main__ - INFO - Output directory: outputs/results
2025-12-07 23:19:40 - __main__ - INFO - 
================================================================================
2025-12-07 23:19:40 - __main__ - INFO - Run 1/5: phi-2 | qa | float16
2025-12-07 23:19:40 - __main__ - INFO - ================================================================================
2025-12-07 23:19:44 - src.utils.gpu - INFO - [start_phi-2_qa] GPU State: Allocated: 0.0MB | Reserved: 0.0MB | Free: 81155.8MB | Utilization: 0.0%
2025-12-07 23:19:44 - __main__ - INFO - Loading qa dataset (10000 samples)...
2025-12-07 23:19:44 - src.data.dataset_loader - INFO - Loading MMLU dataset with 10000 samples...
2025-12-07 23:19:47 - src.data.dataset_loader - INFO - Loaded 10000 MMLU instances
2025-12-07 23:19:47 - src.utils.gpu - INFO - [dataset_loading] Duration: 3573.61ms | GPU Memory: 0.0MB -> 0.0MB (delta +0.0MB)
2025-12-07 23:19:47 - src.data.dataset_processor - INFO - Processing qa dataset to 6-option format...
2025-12-07 23:19:48 - src.data.dataset_processor - INFO - Processed 10000 instances for qa
2025-12-07 23:19:48 - src.data.data_splitter - INFO - Splitting qa dataset (calibration: 50%, test: 50%)
2025-12-07 23:19:48 - src.data.data_splitter - INFO - Split complete:
2025-12-07 23:19:48 - src.data.data_splitter - INFO -   Calibration: 4998 instances
2025-12-07 23:19:48 - src.data.data_splitter - INFO -   Test: 5002 instances
2025-12-07 23:19:48 - src.data.data_splitter - WARNING - Calibration size 4998 differs from expected 5000
2025-12-07 23:19:48 - src.data.data_splitter - INFO - Answer distribution:
2025-12-07 23:19:48 - src.data.data_splitter - INFO -   Calibration: {'A': 1174, 'B': 1230, 'C': 1242, 'D': 1352}
2025-12-07 23:19:48 - src.data.data_splitter - INFO -   Test: {'A': 1175, 'B': 1231, 'C': 1243, 'D': 1353}
2025-12-07 23:19:48 - src.utils.gpu - INFO - [dataset_processing] Duration: 353.71ms | GPU Memory: 0.0MB -> 0.0MB (delta +0.0MB)
2025-12-07 23:19:48 - src.prompting.demonstration_manager - INFO - Initialized DemonstrationSelector
2025-12-07 23:19:48 - src.prompting.demonstration_manager - INFO -   Strategy: random
2025-12-07 23:19:48 - src.prompting.demonstration_manager - INFO -   Num demonstrations: 5
2025-12-07 23:19:48 - src.prompting.demonstration_manager - INFO - Initialized DemonstrationManager
2025-12-07 23:19:48 - src.prompting.demonstration_manager - INFO - Selecting 5 demonstrations using 'random' strategy
2025-12-07 23:19:48 - src.prompting.demonstration_manager - INFO - Selected and cached 5 demonstrations for qa
2025-12-07 23:19:48 - __main__ - INFO - Loading model: phi-2 (float16)
2025-12-07 23:19:48 - src.models.model_loader - INFO - Loading model: phi-2_float16 (microsoft/phi-2)
2025-12-07 23:19:48 - src.models.model_loader - INFO - Loading tokenizer from microsoft/phi-2
2025-12-07 23:19:48 - src.models.model_loader - INFO - Tokenizer loaded successfully
2025-12-07 23:19:48 - src.models.model_loader - INFO -   Vocab size: 50295
2025-12-07 23:19:48 - src.models.model_loader - INFO -   Padding side: left
2025-12-07 23:19:48 - src.models.model_loader - INFO -   PAD token: <|endoftext|> (ID: 50256)
2025-12-07 23:19:48 - src.models.model_loader - INFO - Loading model from microsoft/phi-2
2025-12-07 23:19:48 - accelerate.utils.modeling - INFO - We will use 90% of the memory on device 0 for storing the model, and 10% for the buffer to avoid OOM. You can set `max_memory` in to a higher value to use more memory (at your own risk).
2025-12-07 23:19:50 - src.models.model_loader - INFO - Model loaded successfully
2025-12-07 23:19:50 - src.models.model_loader - INFO -   GPU Memory: 5.18GB allocated, 5.18GB reserved
2025-12-07 23:19:50 - src.utils.gpu - INFO - [model_loading] Duration: 1878.88ms | GPU Memory: 0.0MB -> 5301.8MB (delta +5301.8MB)
2025-12-07 23:19:50 - src.utils.gpu - INFO - [after_model_load_phi-2] GPU State: Allocated: 5301.8MB | Reserved: 5308.0MB | Free: 75853.9MB | Utilization: 0.0%
2025-12-07 23:19:50 - __main__ - INFO - Using batch size: 32
2025-12-07 23:19:50 - __main__ - INFO -   Strategy: base
2025-12-07 23:19:50 - src.prompting.prompt_builder - INFO - Initialized PromptBuilder for task: qa
2025-12-07 23:19:50 - src.prompting.prompt_builder - INFO -   Available strategies: ['base', 'shared_instruction', 'task_specific']
2025-12-07 23:19:50 - src.prompting.prompt_builder - INFO - Building 10000 prompts using 'base' strategy with 5 demonstrations
2025-12-07 23:19:50 - src.models.inference_engine - INFO - Initialized InferenceEngine for phi-2_float16
2025-12-07 23:19:50 - src.models.inference_engine - INFO -   Device: cuda:0
2025-12-07 23:19:50 - src.models.inference_engine - INFO -   Batch size: 32
2025-12-07 23:19:50 - src.models.inference_engine - INFO -   Option tokens: {'A': 317, 'B': 347, 'C': 327, 'D': 360, 'E': 412, 'F': 376}
2025-12-07 23:25:39 - src.utils.gpu - INFO - [inference_calibration] Duration: 349138.57ms | GPU Memory: 5301.8MB -> 5311.0MB (delta +9.1MB)
2025-12-07 23:31:28 - src.utils.gpu - INFO - [inference_test] Duration: 349401.96ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 23:31:28 - __main__ - INFO -     Inference: 698.54s for 10000 samples (14.32 samples/sec)
2025-12-07 23:31:28 - src.models.probability_extractor - INFO - Initialized ProbabilityExtractor
2025-12-07 23:31:28 - src.models.probability_extractor - INFO -   Temperature: 1.0
2025-12-07 23:31:28 - src.models.probability_extractor - INFO -   Calibration method: None
2025-12-07 23:31:29 - src.utils.gpu - INFO - [probability_extraction] Duration: 257.17ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 23:31:29 - __main__ - INFO -     Raw probabilities saved to: outputs/results/probabilities/probs_phi-2_qa_float16_base_20251207_231938.npz
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO - Initialized LACScorer
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO -   Alpha: 0.1
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO -   Target coverage: 90.0%
2025-12-07 23:31:29 - src.conformal.scorers - INFO - Initialized LAC (Least Ambiguous set-valued Classifiers) scorer
2025-12-07 23:31:29 - src.conformal.prediction_set_generator - INFO - Initialized PredictionSetGenerator
2025-12-07 23:31:29 - src.conformal.prediction_set_generator - INFO -   Methods: ['lac']
2025-12-07 23:31:29 - src.conformal.prediction_set_generator - INFO -   Alpha: 0.1
2025-12-07 23:31:29 - src.conformal.prediction_set_generator - INFO -   Aggregation: separate
2025-12-07 23:31:29 - src.conformal.prediction_set_generator - INFO - Calibrating 1 conformal predictors...
2025-12-07 23:31:29 - src.conformal.prediction_set_generator - INFO -   Calibrating LAC...
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO - Calibrating with 4998 samples...
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO - Calibration complete
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO -   Threshold: 0.9863
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO -   Score range: [0.0005, 1.0000]
2025-12-07 23:31:29 - src.conformal.prediction_set_generator - INFO - Calibration complete
2025-12-07 23:31:29 - src.conformal.prediction_set_generator - INFO - Generating prediction sets using LAC...
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO - Generating prediction sets for 5002 test instances...
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO - Prediction complete
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO -   Average set size: 5.39
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO -   Coverage rate: 90.34%
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO -   Meets coverage guarantee: True
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO - [PASS] Coverage guarantee met: 90.34% >= 90.00%
2025-12-07 23:31:29 - __main__ - INFO -     LAC: Acc=21.65%, CR=90.34%, SS=5.39
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO - Initialized APSScorer
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO -   Alpha: 0.1
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO -   Target coverage: 90.0%
2025-12-07 23:31:29 - src.conformal.scorers - INFO - Initialized APS (Adaptive Prediction Sets) scorer
2025-12-07 23:31:29 - src.conformal.prediction_set_generator - INFO - Initialized PredictionSetGenerator
2025-12-07 23:31:29 - src.conformal.prediction_set_generator - INFO -   Methods: ['aps']
2025-12-07 23:31:29 - src.conformal.prediction_set_generator - INFO -   Alpha: 0.1
2025-12-07 23:31:29 - src.conformal.prediction_set_generator - INFO -   Aggregation: separate
2025-12-07 23:31:29 - src.conformal.prediction_set_generator - INFO - Calibrating 1 conformal predictors...
2025-12-07 23:31:29 - src.conformal.prediction_set_generator - INFO -   Calibrating APS...
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO - Calibrating with 4998 samples...
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO - Calibration complete
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO -   Threshold: 1.0000
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO -   Score range: [0.2081, 1.0000]
2025-12-07 23:31:29 - src.conformal.prediction_set_generator - INFO - Calibration complete
2025-12-07 23:31:29 - src.conformal.prediction_set_generator - INFO - Generating prediction sets using APS...
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO - Generating prediction sets for 5002 test instances...
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO - Prediction complete
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO -   Average set size: 5.84
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO -   Coverage rate: 97.72%
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO -   Meets coverage guarantee: True
2025-12-07 23:31:29 - src.conformal.conformal_base - INFO - [PASS] Coverage guarantee met: 97.72% >= 90.00%
2025-12-07 23:31:29 - __main__ - INFO -     APS: Acc=21.65%, CR=97.72%, SS=5.84
2025-12-07 23:31:35 - src.models.model_loader - INFO - Unloaded model: phi-2_float16
2025-12-07 23:31:36 - __main__ - INFO - Checkpoint saved after completing: phi-2 | qa | float16
2025-12-07 23:31:36 - __main__ - INFO - 
================================================================================
2025-12-07 23:31:36 - __main__ - INFO - Run 2/5: phi-2 | rc | float16
2025-12-07 23:31:36 - __main__ - INFO - ================================================================================
2025-12-07 23:31:36 - src.utils.gpu - INFO - [start_phi-2_rc] GPU State: Allocated: 9.1MB | Reserved: 22.0MB | Free: 81146.6MB | Utilization: 0.0%
2025-12-07 23:31:36 - __main__ - INFO - Loading rc dataset (10000 samples)...
2025-12-07 23:31:36 - src.data.dataset_loader - INFO - Loading CosmosQA dataset with 10000 samples...
2025-12-07 23:31:36 - src.data.dataset_loader - INFO - CosmosQA loaded successfully with standard method
2025-12-07 23:31:38 - src.data.dataset_loader - INFO - Loaded 10000 CosmosQA instances
2025-12-07 23:31:38 - src.utils.gpu - INFO - [dataset_loading] Duration: 1863.02ms | GPU Memory: 9.1MB -> 9.1MB (delta +0.0MB)
2025-12-07 23:31:38 - src.data.dataset_processor - INFO - Processing rc dataset to 6-option format...
2025-12-07 23:31:38 - src.data.dataset_processor - INFO - Processed 10000 instances for rc
2025-12-07 23:31:38 - src.data.data_splitter - INFO - Splitting rc dataset (calibration: 50%, test: 50%)
2025-12-07 23:31:38 - src.data.data_splitter - INFO - Split complete:
2025-12-07 23:31:38 - src.data.data_splitter - INFO -   Calibration: 4999 instances
2025-12-07 23:31:38 - src.data.data_splitter - INFO -   Test: 5001 instances
2025-12-07 23:31:38 - src.data.data_splitter - INFO - Answer distribution:
2025-12-07 23:31:38 - src.data.data_splitter - INFO -   Calibration: {'A': 1240, 'B': 1245, 'C': 1263, 'D': 1251}
2025-12-07 23:31:38 - src.data.data_splitter - INFO -   Test: {'A': 1241, 'B': 1245, 'C': 1264, 'D': 1251}
2025-12-07 23:31:38 - src.utils.gpu - INFO - [dataset_processing] Duration: 288.09ms | GPU Memory: 9.1MB -> 9.1MB (delta +0.0MB)
2025-12-07 23:31:38 - src.prompting.demonstration_manager - INFO - Initialized DemonstrationSelector
2025-12-07 23:31:38 - src.prompting.demonstration_manager - INFO -   Strategy: random
2025-12-07 23:31:38 - src.prompting.demonstration_manager - INFO -   Num demonstrations: 5
2025-12-07 23:31:38 - src.prompting.demonstration_manager - INFO - Initialized DemonstrationManager
2025-12-07 23:31:38 - src.prompting.demonstration_manager - INFO - Selecting 5 demonstrations using 'random' strategy
2025-12-07 23:31:38 - src.prompting.demonstration_manager - INFO - Selected and cached 5 demonstrations for rc
2025-12-07 23:31:38 - __main__ - INFO - Loading model: phi-2 (float16)
2025-12-07 23:31:38 - src.models.model_loader - INFO - Loading model: phi-2_float16 (microsoft/phi-2)
2025-12-07 23:31:38 - src.models.model_loader - INFO - Loading tokenizer from microsoft/phi-2
2025-12-07 23:31:38 - src.models.model_loader - INFO - Tokenizer loaded successfully
2025-12-07 23:31:38 - src.models.model_loader - INFO -   Vocab size: 50295
2025-12-07 23:31:38 - src.models.model_loader - INFO -   Padding side: left
2025-12-07 23:31:38 - src.models.model_loader - INFO -   PAD token: <|endoftext|> (ID: 50256)
2025-12-07 23:31:38 - src.models.model_loader - INFO - Loading model from microsoft/phi-2
2025-12-07 23:31:38 - accelerate.utils.modeling - INFO - We will use 90% of the memory on device 0 for storing the model, and 10% for the buffer to avoid OOM. You can set `max_memory` in to a higher value to use more memory (at your own risk).
2025-12-07 23:31:40 - src.models.model_loader - INFO - Model loaded successfully
2025-12-07 23:31:40 - src.models.model_loader - INFO -   GPU Memory: 5.19GB allocated, 5.21GB reserved
2025-12-07 23:31:40 - src.utils.gpu - INFO - [model_loading] Duration: 2194.20ms | GPU Memory: 9.1MB -> 5311.0MB (delta +5301.8MB)
2025-12-07 23:31:40 - src.utils.gpu - INFO - [after_model_load_phi-2] GPU State: Allocated: 5311.0MB | Reserved: 5334.0MB | Free: 75844.8MB | Utilization: 20.0%
2025-12-07 23:31:40 - __main__ - INFO - Using batch size: 32
2025-12-07 23:31:40 - __main__ - INFO -   Strategy: base
2025-12-07 23:31:40 - src.prompting.prompt_builder - INFO - Initialized PromptBuilder for task: rc
2025-12-07 23:31:40 - src.prompting.prompt_builder - INFO -   Available strategies: ['base', 'shared_instruction', 'task_specific']
2025-12-07 23:31:40 - src.prompting.prompt_builder - INFO - Building 10000 prompts using 'base' strategy with 5 demonstrations
2025-12-07 23:31:40 - src.models.inference_engine - INFO - Initialized InferenceEngine for phi-2_float16
2025-12-07 23:31:40 - src.models.inference_engine - INFO -   Device: cuda:0
2025-12-07 23:31:40 - src.models.inference_engine - INFO -   Batch size: 32
2025-12-07 23:31:40 - src.models.inference_engine - INFO -   Option tokens: {'A': 317, 'B': 347, 'C': 327, 'D': 360, 'E': 412, 'F': 376}
2025-12-07 23:36:21 - src.utils.gpu - INFO - [inference_calibration] Duration: 281212.78ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 23:41:04 - src.utils.gpu - INFO - [inference_test] Duration: 282117.88ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 23:41:04 - __main__ - INFO -     Inference: 563.33s for 10000 samples (17.75 samples/sec)
2025-12-07 23:41:04 - src.models.probability_extractor - INFO - Initialized ProbabilityExtractor
2025-12-07 23:41:04 - src.models.probability_extractor - INFO -   Temperature: 1.0
2025-12-07 23:41:04 - src.models.probability_extractor - INFO -   Calibration method: None
2025-12-07 23:41:04 - src.utils.gpu - INFO - [probability_extraction] Duration: 322.40ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 23:41:04 - __main__ - INFO -     Raw probabilities saved to: outputs/results/probabilities/probs_phi-2_rc_float16_base_20251207_231938.npz
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO - Initialized LACScorer
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO -   Alpha: 0.1
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO -   Target coverage: 90.0%
2025-12-07 23:41:04 - src.conformal.scorers - INFO - Initialized LAC (Least Ambiguous set-valued Classifiers) scorer
2025-12-07 23:41:04 - src.conformal.prediction_set_generator - INFO - Initialized PredictionSetGenerator
2025-12-07 23:41:04 - src.conformal.prediction_set_generator - INFO -   Methods: ['lac']
2025-12-07 23:41:04 - src.conformal.prediction_set_generator - INFO -   Alpha: 0.1
2025-12-07 23:41:04 - src.conformal.prediction_set_generator - INFO -   Aggregation: separate
2025-12-07 23:41:04 - src.conformal.prediction_set_generator - INFO - Calibrating 1 conformal predictors...
2025-12-07 23:41:04 - src.conformal.prediction_set_generator - INFO -   Calibrating LAC...
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO - Calibrating with 4999 samples...
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO - Calibration complete
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO -   Threshold: 0.9800
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO -   Score range: [0.0003, 1.0000]
2025-12-07 23:41:04 - src.conformal.prediction_set_generator - INFO - Calibration complete
2025-12-07 23:41:04 - src.conformal.prediction_set_generator - INFO - Generating prediction sets using LAC...
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO - Generating prediction sets for 5001 test instances...
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO - Prediction complete
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO -   Average set size: 5.24
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO -   Coverage rate: 90.90%
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO -   Meets coverage guarantee: True
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO - [PASS] Coverage guarantee met: 90.90% >= 90.00%
2025-12-07 23:41:04 - __main__ - INFO -     LAC: Acc=23.82%, CR=90.90%, SS=5.24
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO - Initialized APSScorer
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO -   Alpha: 0.1
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO -   Target coverage: 90.0%
2025-12-07 23:41:04 - src.conformal.scorers - INFO - Initialized APS (Adaptive Prediction Sets) scorer
2025-12-07 23:41:04 - src.conformal.prediction_set_generator - INFO - Initialized PredictionSetGenerator
2025-12-07 23:41:04 - src.conformal.prediction_set_generator - INFO -   Methods: ['aps']
2025-12-07 23:41:04 - src.conformal.prediction_set_generator - INFO -   Alpha: 0.1
2025-12-07 23:41:04 - src.conformal.prediction_set_generator - INFO -   Aggregation: separate
2025-12-07 23:41:04 - src.conformal.prediction_set_generator - INFO - Calibrating 1 conformal predictors...
2025-12-07 23:41:04 - src.conformal.prediction_set_generator - INFO -   Calibrating APS...
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO - Calibrating with 4999 samples...
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO - Calibration complete
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO -   Threshold: 1.0000
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO -   Score range: [0.2005, 1.0000]
2025-12-07 23:41:04 - src.conformal.prediction_set_generator - INFO - Calibration complete
2025-12-07 23:41:04 - src.conformal.prediction_set_generator - INFO - Generating prediction sets using APS...
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO - Generating prediction sets for 5001 test instances...
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO - Prediction complete
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO -   Average set size: 5.17
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO -   Coverage rate: 90.92%
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO -   Meets coverage guarantee: True
2025-12-07 23:41:04 - src.conformal.conformal_base - INFO - [PASS] Coverage guarantee met: 90.92% >= 90.00%
2025-12-07 23:41:04 - __main__ - INFO -     APS: Acc=23.82%, CR=90.92%, SS=5.17
2025-12-07 23:41:10 - src.models.model_loader - INFO - Unloaded model: phi-2_float16
2025-12-07 23:41:11 - __main__ - INFO - Checkpoint saved after completing: phi-2 | rc | float16
2025-12-07 23:41:11 - __main__ - INFO - 
================================================================================
2025-12-07 23:41:11 - __main__ - INFO - Run 3/5: phi-2 | ci | float16
2025-12-07 23:41:11 - __main__ - INFO - ================================================================================
2025-12-07 23:41:11 - src.utils.gpu - INFO - [start_phi-2_ci] GPU State: Allocated: 9.1MB | Reserved: 22.0MB | Free: 81146.6MB | Utilization: 0.0%
2025-12-07 23:41:11 - __main__ - INFO - Loading ci dataset (10000 samples)...
2025-12-07 23:41:11 - src.data.dataset_loader - INFO - Loading HellaSwag dataset with 10000 samples...
2025-12-07 23:41:15 - src.data.dataset_loader - INFO - Loaded 10000 HellaSwag instances
2025-12-07 23:41:15 - src.utils.gpu - INFO - [dataset_loading] Duration: 4226.69ms | GPU Memory: 9.1MB -> 9.1MB (delta +0.0MB)
2025-12-07 23:41:15 - src.data.dataset_processor - INFO - Processing ci dataset to 6-option format...
2025-12-07 23:41:15 - src.data.dataset_processor - INFO - Processed 10000 instances for ci
2025-12-07 23:41:15 - src.data.data_splitter - INFO - Splitting ci dataset (calibration: 50%, test: 50%)
2025-12-07 23:41:15 - src.data.data_splitter - INFO - Split complete:
2025-12-07 23:41:15 - src.data.data_splitter - INFO -   Calibration: 4999 instances
2025-12-07 23:41:15 - src.data.data_splitter - INFO -   Test: 5001 instances
2025-12-07 23:41:15 - src.data.data_splitter - INFO - Answer distribution:
2025-12-07 23:41:15 - src.data.data_splitter - INFO -   Calibration: {'A': 1240, 'B': 1242, 'C': 1256, 'D': 1261}
2025-12-07 23:41:15 - src.data.data_splitter - INFO -   Test: {'A': 1240, 'B': 1242, 'C': 1257, 'D': 1262}
2025-12-07 23:41:15 - src.utils.gpu - INFO - [dataset_processing] Duration: 224.73ms | GPU Memory: 9.1MB -> 9.1MB (delta +0.0MB)
2025-12-07 23:41:15 - src.prompting.demonstration_manager - INFO - Initialized DemonstrationSelector
2025-12-07 23:41:15 - src.prompting.demonstration_manager - INFO -   Strategy: random
2025-12-07 23:41:15 - src.prompting.demonstration_manager - INFO -   Num demonstrations: 5
2025-12-07 23:41:15 - src.prompting.demonstration_manager - INFO - Initialized DemonstrationManager
2025-12-07 23:41:15 - src.prompting.demonstration_manager - INFO - Selecting 5 demonstrations using 'random' strategy
2025-12-07 23:41:15 - src.prompting.demonstration_manager - INFO - Selected and cached 5 demonstrations for ci
2025-12-07 23:41:15 - __main__ - INFO - Loading model: phi-2 (float16)
2025-12-07 23:41:15 - src.models.model_loader - INFO - Loading model: phi-2_float16 (microsoft/phi-2)
2025-12-07 23:41:15 - src.models.model_loader - INFO - Loading tokenizer from microsoft/phi-2
2025-12-07 23:41:16 - src.models.model_loader - INFO - Tokenizer loaded successfully
2025-12-07 23:41:16 - src.models.model_loader - INFO -   Vocab size: 50295
2025-12-07 23:41:16 - src.models.model_loader - INFO -   Padding side: left
2025-12-07 23:41:16 - src.models.model_loader - INFO -   PAD token: <|endoftext|> (ID: 50256)
2025-12-07 23:41:16 - src.models.model_loader - INFO - Loading model from microsoft/phi-2
2025-12-07 23:41:16 - accelerate.utils.modeling - INFO - We will use 90% of the memory on device 0 for storing the model, and 10% for the buffer to avoid OOM. You can set `max_memory` in to a higher value to use more memory (at your own risk).
2025-12-07 23:41:18 - src.models.model_loader - INFO - Model loaded successfully
2025-12-07 23:41:18 - src.models.model_loader - INFO -   GPU Memory: 5.19GB allocated, 5.21GB reserved
2025-12-07 23:41:18 - src.utils.gpu - INFO - [model_loading] Duration: 2202.44ms | GPU Memory: 9.1MB -> 5311.0MB (delta +5301.8MB)
2025-12-07 23:41:18 - src.utils.gpu - INFO - [after_model_load_phi-2] GPU State: Allocated: 5311.0MB | Reserved: 5334.0MB | Free: 75844.8MB | Utilization: 0.0%
2025-12-07 23:41:18 - __main__ - INFO - Using batch size: 32
2025-12-07 23:41:18 - __main__ - INFO -   Strategy: base
2025-12-07 23:41:18 - src.prompting.prompt_builder - INFO - Initialized PromptBuilder for task: ci
2025-12-07 23:41:18 - src.prompting.prompt_builder - INFO -   Available strategies: ['base', 'shared_instruction', 'task_specific']
2025-12-07 23:41:18 - src.prompting.prompt_builder - INFO - Building 10000 prompts using 'base' strategy with 5 demonstrations
2025-12-07 23:41:18 - src.models.inference_engine - INFO - Initialized InferenceEngine for phi-2_float16
2025-12-07 23:41:18 - src.models.inference_engine - INFO -   Device: cuda:0
2025-12-07 23:41:18 - src.models.inference_engine - INFO -   Batch size: 32
2025-12-07 23:41:18 - src.models.inference_engine - INFO -   Option tokens: {'A': 317, 'B': 347, 'C': 327, 'D': 360, 'E': 412, 'F': 376}
2025-12-07 23:46:04 - src.utils.gpu - INFO - [inference_calibration] Duration: 286812.13ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 23:59:10 - src.utils.gpu - INFO - [inference_test] Duration: 785753.95ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 23:59:10 - __main__ - INFO -     Inference: 1072.57s for 10000 samples (9.32 samples/sec)
2025-12-07 23:59:10 - src.models.probability_extractor - INFO - Initialized ProbabilityExtractor
2025-12-07 23:59:10 - src.models.probability_extractor - INFO -   Temperature: 1.0
2025-12-07 23:59:10 - src.models.probability_extractor - INFO -   Calibration method: None
2025-12-07 23:59:10 - src.utils.gpu - INFO - [probability_extraction] Duration: 254.17ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-07 23:59:11 - __main__ - INFO -     Raw probabilities saved to: outputs/results/probabilities/probs_phi-2_ci_float16_base_20251207_231938.npz
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO - Initialized LACScorer
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO -   Alpha: 0.1
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO -   Target coverage: 90.0%
2025-12-07 23:59:11 - src.conformal.scorers - INFO - Initialized LAC (Least Ambiguous set-valued Classifiers) scorer
2025-12-07 23:59:11 - src.conformal.prediction_set_generator - INFO - Initialized PredictionSetGenerator
2025-12-07 23:59:11 - src.conformal.prediction_set_generator - INFO -   Methods: ['lac']
2025-12-07 23:59:11 - src.conformal.prediction_set_generator - INFO -   Alpha: 0.1
2025-12-07 23:59:11 - src.conformal.prediction_set_generator - INFO -   Aggregation: separate
2025-12-07 23:59:11 - src.conformal.prediction_set_generator - INFO - Calibrating 1 conformal predictors...
2025-12-07 23:59:11 - src.conformal.prediction_set_generator - INFO -   Calibrating LAC...
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO - Calibrating with 4999 samples...
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO - Calibration complete
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO -   Threshold: 0.9834
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO -   Score range: [0.0008, 1.0000]
2025-12-07 23:59:11 - src.conformal.prediction_set_generator - INFO - Calibration complete
2025-12-07 23:59:11 - src.conformal.prediction_set_generator - INFO - Generating prediction sets using LAC...
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO - Generating prediction sets for 5001 test instances...
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO - Prediction complete
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO -   Average set size: 5.24
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO -   Coverage rate: 89.96%
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO -   Meets coverage guarantee: False
2025-12-07 23:59:11 - src.conformal.conformal_base - WARNING - ✗ Coverage guarantee NOT met: 89.96% < 90.00%
2025-12-07 23:59:11 - src.conformal.prediction_set_generator - WARNING - LAC does not meet coverage guarantee: 89.96% < 90.00%
2025-12-07 23:59:11 - __main__ - INFO -     LAC: Acc=22.40%, CR=89.96%, SS=5.24
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO - Initialized APSScorer
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO -   Alpha: 0.1
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO -   Target coverage: 90.0%
2025-12-07 23:59:11 - src.conformal.scorers - INFO - Initialized APS (Adaptive Prediction Sets) scorer
2025-12-07 23:59:11 - src.conformal.prediction_set_generator - INFO - Initialized PredictionSetGenerator
2025-12-07 23:59:11 - src.conformal.prediction_set_generator - INFO -   Methods: ['aps']
2025-12-07 23:59:11 - src.conformal.prediction_set_generator - INFO -   Alpha: 0.1
2025-12-07 23:59:11 - src.conformal.prediction_set_generator - INFO -   Aggregation: separate
2025-12-07 23:59:11 - src.conformal.prediction_set_generator - INFO - Calibrating 1 conformal predictors...
2025-12-07 23:59:11 - src.conformal.prediction_set_generator - INFO -   Calibrating APS...
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO - Calibrating with 4999 samples...
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO - Calibration complete
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO -   Threshold: 1.0000
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO -   Score range: [0.2022, 1.0000]
2025-12-07 23:59:11 - src.conformal.prediction_set_generator - INFO - Calibration complete
2025-12-07 23:59:11 - src.conformal.prediction_set_generator - INFO - Generating prediction sets using APS...
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO - Generating prediction sets for 5001 test instances...
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO - Prediction complete
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO -   Average set size: 5.85
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO -   Coverage rate: 98.28%
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO -   Meets coverage guarantee: True
2025-12-07 23:59:11 - src.conformal.conformal_base - INFO - [PASS] Coverage guarantee met: 98.28% >= 90.00%
2025-12-07 23:59:11 - __main__ - INFO -     APS: Acc=22.40%, CR=98.28%, SS=5.85
2025-12-07 23:59:16 - src.models.model_loader - INFO - Unloaded model: phi-2_float16
2025-12-07 23:59:17 - __main__ - INFO - Checkpoint saved after completing: phi-2 | ci | float16
2025-12-07 23:59:17 - __main__ - INFO - 
================================================================================
2025-12-07 23:59:17 - __main__ - INFO - Run 4/5: phi-2 | drs | float16
2025-12-07 23:59:17 - __main__ - INFO - ================================================================================
2025-12-07 23:59:17 - src.utils.gpu - INFO - [start_phi-2_drs] GPU State: Allocated: 9.1MB | Reserved: 22.0MB | Free: 81146.6MB | Utilization: 100.0%
2025-12-07 23:59:17 - __main__ - INFO - Loading drs dataset (10000 samples)...
2025-12-07 23:59:17 - src.data.dataset_loader - INFO - Loading HaluDial dataset with 10000 samples...
2025-12-07 23:59:20 - src.data.dataset_loader - INFO - Loaded 10000 HaluDial instances
2025-12-07 23:59:20 - src.utils.gpu - INFO - [dataset_loading] Duration: 2787.29ms | GPU Memory: 9.1MB -> 9.1MB (delta +0.0MB)
2025-12-07 23:59:20 - src.data.dataset_processor - INFO - Processing drs dataset to 6-option format...
2025-12-07 23:59:52 - src.data.dataset_processor - INFO - Processed 10000 instances for drs
2025-12-07 23:59:52 - src.data.dataset_processor - INFO - Option expansion statistics for drs:
2025-12-07 23:59:52 - src.data.dataset_processor - INFO -   Instances expanded (2→4 options): 10000
2025-12-07 23:59:52 - src.data.dataset_processor - INFO -   Total options sampled: 20000
2025-12-07 23:59:52 - src.data.dataset_processor - INFO -   Duplicate options avoided: 2
2025-12-07 23:59:52 - src.data.dataset_processor - INFO -   Fallback options used: 0
2025-12-07 23:59:52 - src.data.data_splitter - INFO - Splitting drs dataset (calibration: 50%, test: 50%)
2025-12-07 23:59:52 - src.data.data_splitter - INFO - Split complete:
2025-12-07 23:59:52 - src.data.data_splitter - INFO -   Calibration: 4999 instances
2025-12-07 23:59:52 - src.data.data_splitter - INFO -   Test: 5001 instances
2025-12-07 23:59:52 - src.data.data_splitter - INFO - Answer distribution:
2025-12-07 23:59:52 - src.data.data_splitter - INFO -   Calibration: {'A': 1258, 'B': 1203, 'C': 1264, 'D': 1274}
2025-12-07 23:59:52 - src.data.data_splitter - INFO -   Test: {'A': 1258, 'B': 1204, 'C': 1265, 'D': 1274}
2025-12-07 23:59:52 - src.utils.gpu - INFO - [dataset_processing] Duration: 32442.29ms | GPU Memory: 9.1MB -> 9.1MB (delta +0.0MB)
2025-12-07 23:59:52 - src.prompting.demonstration_manager - INFO - Initialized DemonstrationSelector
2025-12-07 23:59:52 - src.prompting.demonstration_manager - INFO -   Strategy: random
2025-12-07 23:59:52 - src.prompting.demonstration_manager - INFO -   Num demonstrations: 5
2025-12-07 23:59:52 - src.prompting.demonstration_manager - INFO - Initialized DemonstrationManager
2025-12-07 23:59:52 - src.prompting.demonstration_manager - INFO - Selecting 3 demonstrations using 'random' strategy
2025-12-07 23:59:52 - src.prompting.demonstration_manager - INFO - Selected and cached 3 demonstrations for drs
2025-12-07 23:59:52 - __main__ - INFO - Loading model: phi-2 (float16)
2025-12-07 23:59:52 - src.models.model_loader - INFO - Loading model: phi-2_float16 (microsoft/phi-2)
2025-12-07 23:59:52 - src.models.model_loader - INFO - Loading tokenizer from microsoft/phi-2
2025-12-07 23:59:53 - src.models.model_loader - INFO - Tokenizer loaded successfully
2025-12-07 23:59:53 - src.models.model_loader - INFO -   Vocab size: 50295
2025-12-07 23:59:53 - src.models.model_loader - INFO -   Padding side: left
2025-12-07 23:59:53 - src.models.model_loader - INFO -   PAD token: <|endoftext|> (ID: 50256)
2025-12-07 23:59:53 - src.models.model_loader - INFO - Loading model from microsoft/phi-2
2025-12-07 23:59:53 - accelerate.utils.modeling - INFO - We will use 90% of the memory on device 0 for storing the model, and 10% for the buffer to avoid OOM. You can set `max_memory` in to a higher value to use more memory (at your own risk).
2025-12-07 23:59:55 - src.models.model_loader - INFO - Model loaded successfully
2025-12-07 23:59:55 - src.models.model_loader - INFO -   GPU Memory: 5.19GB allocated, 5.21GB reserved
2025-12-07 23:59:55 - src.utils.gpu - INFO - [model_loading] Duration: 2406.98ms | GPU Memory: 9.1MB -> 5311.0MB (delta +5301.8MB)
2025-12-07 23:59:55 - src.utils.gpu - INFO - [after_model_load_phi-2] GPU State: Allocated: 5311.0MB | Reserved: 5334.0MB | Free: 75844.8MB | Utilization: 100.0%
2025-12-07 23:59:55 - __main__ - INFO - Using batch size: 32
2025-12-07 23:59:55 - __main__ - INFO -   Strategy: base
2025-12-07 23:59:55 - src.prompting.prompt_builder - INFO - Initialized PromptBuilder for task: drs
2025-12-07 23:59:55 - src.prompting.prompt_builder - INFO -   Available strategies: ['base', 'shared_instruction', 'task_specific']
2025-12-07 23:59:55 - src.prompting.prompt_builder - INFO - Building 10000 prompts using 'base' strategy with 3 demonstrations
2025-12-07 23:59:55 - src.models.inference_engine - INFO - Initialized InferenceEngine for phi-2_float16
2025-12-07 23:59:55 - src.models.inference_engine - INFO -   Device: cuda:0
2025-12-07 23:59:55 - src.models.inference_engine - INFO -   Batch size: 32
2025-12-07 23:59:55 - src.models.inference_engine - INFO -   Option tokens: {'A': 317, 'B': 347, 'C': 327, 'D': 360, 'E': 412, 'F': 376}
2025-12-08 00:08:03 - src.utils.gpu - INFO - [inference_calibration] Duration: 487634.36ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-08 00:16:18 - src.utils.gpu - INFO - [inference_test] Duration: 495760.56ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-08 00:16:18 - __main__ - INFO -     Inference: 983.40s for 10000 samples (10.17 samples/sec)
2025-12-08 00:16:18 - src.models.probability_extractor - INFO - Initialized ProbabilityExtractor
2025-12-08 00:16:18 - src.models.probability_extractor - INFO -   Temperature: 1.0
2025-12-08 00:16:18 - src.models.probability_extractor - INFO -   Calibration method: None
2025-12-08 00:16:19 - src.utils.gpu - INFO - [probability_extraction] Duration: 289.63ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-08 00:16:19 - __main__ - INFO -     Raw probabilities saved to: outputs/results/probabilities/probs_phi-2_drs_float16_base_20251207_231938.npz
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO - Initialized LACScorer
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO -   Alpha: 0.1
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO -   Target coverage: 90.0%
2025-12-08 00:16:19 - src.conformal.scorers - INFO - Initialized LAC (Least Ambiguous set-valued Classifiers) scorer
2025-12-08 00:16:19 - src.conformal.prediction_set_generator - INFO - Initialized PredictionSetGenerator
2025-12-08 00:16:19 - src.conformal.prediction_set_generator - INFO -   Methods: ['lac']
2025-12-08 00:16:19 - src.conformal.prediction_set_generator - INFO -   Alpha: 0.1
2025-12-08 00:16:19 - src.conformal.prediction_set_generator - INFO -   Aggregation: separate
2025-12-08 00:16:19 - src.conformal.prediction_set_generator - INFO - Calibrating 1 conformal predictors...
2025-12-08 00:16:19 - src.conformal.prediction_set_generator - INFO -   Calibrating LAC...
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO - Calibrating with 4999 samples...
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO - Calibration complete
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO -   Threshold: 0.9799
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO -   Score range: [0.0000, 1.0000]
2025-12-08 00:16:19 - src.conformal.prediction_set_generator - INFO - Calibration complete
2025-12-08 00:16:19 - src.conformal.prediction_set_generator - INFO - Generating prediction sets using LAC...
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO - Generating prediction sets for 5001 test instances...
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO - Prediction complete
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO -   Average set size: 5.25
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO -   Coverage rate: 89.56%
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO -   Meets coverage guarantee: False
2025-12-08 00:16:19 - src.conformal.conformal_base - WARNING - ✗ Coverage guarantee NOT met: 89.56% < 90.00%
2025-12-08 00:16:19 - src.conformal.prediction_set_generator - WARNING - LAC does not meet coverage guarantee: 89.56% < 90.00%
2025-12-08 00:16:19 - __main__ - INFO -     LAC: Acc=22.00%, CR=89.56%, SS=5.25
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO - Initialized APSScorer
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO -   Alpha: 0.1
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO -   Target coverage: 90.0%
2025-12-08 00:16:19 - src.conformal.scorers - INFO - Initialized APS (Adaptive Prediction Sets) scorer
2025-12-08 00:16:19 - src.conformal.prediction_set_generator - INFO - Initialized PredictionSetGenerator
2025-12-08 00:16:19 - src.conformal.prediction_set_generator - INFO -   Methods: ['aps']
2025-12-08 00:16:19 - src.conformal.prediction_set_generator - INFO -   Alpha: 0.1
2025-12-08 00:16:19 - src.conformal.prediction_set_generator - INFO -   Aggregation: separate
2025-12-08 00:16:19 - src.conformal.prediction_set_generator - INFO - Calibrating 1 conformal predictors...
2025-12-08 00:16:19 - src.conformal.prediction_set_generator - INFO -   Calibrating APS...
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO - Calibrating with 4999 samples...
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO - Calibration complete
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO -   Threshold: 1.0000
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO -   Score range: [0.2127, 1.0000]
2025-12-08 00:16:19 - src.conformal.prediction_set_generator - INFO - Calibration complete
2025-12-08 00:16:19 - src.conformal.prediction_set_generator - INFO - Generating prediction sets using APS...
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO - Generating prediction sets for 5001 test instances...
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO - Prediction complete
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO -   Average set size: 5.83
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO -   Coverage rate: 98.22%
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO -   Meets coverage guarantee: True
2025-12-08 00:16:19 - src.conformal.conformal_base - INFO - [PASS] Coverage guarantee met: 98.22% >= 90.00%
2025-12-08 00:16:19 - __main__ - INFO -     APS: Acc=22.00%, CR=98.22%, SS=5.83
2025-12-08 00:16:24 - src.models.model_loader - INFO - Unloaded model: phi-2_float16
2025-12-08 00:16:25 - __main__ - INFO - Checkpoint saved after completing: phi-2 | drs | float16
2025-12-08 00:16:25 - __main__ - INFO - 
================================================================================
2025-12-08 00:16:25 - __main__ - INFO - Run 5/5: phi-2 | ds | float16
2025-12-08 00:16:25 - __main__ - INFO - ================================================================================
2025-12-08 00:16:25 - src.utils.gpu - INFO - [start_phi-2_ds] GPU State: Allocated: 9.1MB | Reserved: 22.0MB | Free: 81146.6MB | Utilization: 82.0%
2025-12-08 00:16:25 - __main__ - INFO - Loading ds dataset (10000 samples)...
2025-12-08 00:16:25 - src.data.dataset_loader - INFO - Loading HaluSum dataset with 10000 samples...
2025-12-08 00:16:26 - src.data.dataset_loader - INFO - Loaded 10000 HaluSum instances
2025-12-08 00:16:26 - src.utils.gpu - INFO - [dataset_loading] Duration: 868.61ms | GPU Memory: 9.1MB -> 9.1MB (delta +0.0MB)
2025-12-08 00:16:26 - src.data.dataset_processor - INFO - Processing ds dataset to 6-option format...
2025-12-08 00:17:00 - src.data.dataset_processor - INFO - Processed 10000 instances for ds
2025-12-08 00:17:00 - src.data.dataset_processor - INFO - Option expansion statistics for ds:
2025-12-08 00:17:00 - src.data.dataset_processor - INFO -   Instances expanded (2→4 options): 10000
2025-12-08 00:17:00 - src.data.dataset_processor - INFO -   Total options sampled: 20000
2025-12-08 00:17:00 - src.data.dataset_processor - INFO -   Duplicate options avoided: 0
2025-12-08 00:17:00 - src.data.dataset_processor - INFO -   Fallback options used: 0
2025-12-08 00:17:00 - src.data.data_splitter - INFO - Splitting ds dataset (calibration: 50%, test: 50%)
2025-12-08 00:17:00 - src.data.data_splitter - INFO - Split complete:
2025-12-08 00:17:00 - src.data.data_splitter - INFO -   Calibration: 4999 instances
2025-12-08 00:17:00 - src.data.data_splitter - INFO -   Test: 5001 instances
2025-12-08 00:17:00 - src.data.data_splitter - INFO - Answer distribution:
2025-12-08 00:17:00 - src.data.data_splitter - INFO -   Calibration: {'A': 1258, 'B': 1203, 'C': 1264, 'D': 1274}
2025-12-08 00:17:00 - src.data.data_splitter - INFO -   Test: {'A': 1258, 'B': 1204, 'C': 1265, 'D': 1274}
2025-12-08 00:17:00 - src.utils.gpu - INFO - [dataset_processing] Duration: 33746.09ms | GPU Memory: 9.1MB -> 9.1MB (delta +0.0MB)
2025-12-08 00:17:00 - src.prompting.demonstration_manager - INFO - Initialized DemonstrationSelector
2025-12-08 00:17:00 - src.prompting.demonstration_manager - INFO -   Strategy: random
2025-12-08 00:17:00 - src.prompting.demonstration_manager - INFO -   Num demonstrations: 5
2025-12-08 00:17:00 - src.prompting.demonstration_manager - INFO - Initialized DemonstrationManager
2025-12-08 00:17:00 - src.prompting.demonstration_manager - INFO - Selecting 1 demonstrations using 'random' strategy
2025-12-08 00:17:00 - src.prompting.demonstration_manager - INFO - Selected and cached 1 demonstrations for ds
2025-12-08 00:17:00 - __main__ - INFO - Loading model: phi-2 (float16)
2025-12-08 00:17:00 - src.models.model_loader - INFO - Loading model: phi-2_float16 (microsoft/phi-2)
2025-12-08 00:17:00 - src.models.model_loader - INFO - Loading tokenizer from microsoft/phi-2
2025-12-08 00:17:00 - src.models.model_loader - INFO - Tokenizer loaded successfully
2025-12-08 00:17:00 - src.models.model_loader - INFO -   Vocab size: 50295
2025-12-08 00:17:00 - src.models.model_loader - INFO -   Padding side: left
2025-12-08 00:17:00 - src.models.model_loader - INFO -   PAD token: <|endoftext|> (ID: 50256)
2025-12-08 00:17:00 - src.models.model_loader - INFO - Loading model from microsoft/phi-2
2025-12-08 00:17:00 - accelerate.utils.modeling - INFO - We will use 90% of the memory on device 0 for storing the model, and 10% for the buffer to avoid OOM. You can set `max_memory` in to a higher value to use more memory (at your own risk).
2025-12-08 00:17:02 - src.models.model_loader - INFO - Model loaded successfully
2025-12-08 00:17:02 - src.models.model_loader - INFO -   GPU Memory: 5.19GB allocated, 5.21GB reserved
2025-12-08 00:17:02 - src.utils.gpu - INFO - [model_loading] Duration: 2381.47ms | GPU Memory: 9.1MB -> 5311.0MB (delta +5301.8MB)
2025-12-08 00:17:02 - src.utils.gpu - INFO - [after_model_load_phi-2] GPU State: Allocated: 5311.0MB | Reserved: 5334.0MB | Free: 75844.8MB | Utilization: 100.0%
2025-12-08 00:17:02 - __main__ - INFO - Using batch size: 32
2025-12-08 00:17:02 - __main__ - INFO -   Strategy: base
2025-12-08 00:17:02 - src.prompting.prompt_builder - INFO - Initialized PromptBuilder for task: ds
2025-12-08 00:17:02 - src.prompting.prompt_builder - INFO -   Available strategies: ['base', 'shared_instruction', 'task_specific']
2025-12-08 00:17:02 - src.prompting.prompt_builder - INFO - Building 10000 prompts using 'base' strategy with 1 demonstrations
2025-12-08 00:17:02 - src.models.inference_engine - INFO - Initialized InferenceEngine for phi-2_float16
2025-12-08 00:17:02 - src.models.inference_engine - INFO -   Device: cuda:0
2025-12-08 00:17:02 - src.models.inference_engine - INFO -   Batch size: 32
2025-12-08 00:17:02 - src.models.inference_engine - INFO -   Option tokens: {'A': 317, 'B': 347, 'C': 327, 'D': 360, 'E': 412, 'F': 376}
2025-12-08 00:43:01 - src.utils.gpu - INFO - [inference_calibration] Duration: 1558456.42ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-08 00:56:50 - src.utils.gpu - INFO - [inference_test] Duration: 828939.55ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-08 00:56:50 - __main__ - INFO -     Inference: 2387.40s for 10000 samples (4.19 samples/sec)
2025-12-08 00:56:50 - src.models.probability_extractor - INFO - Initialized ProbabilityExtractor
2025-12-08 00:56:50 - src.models.probability_extractor - INFO -   Temperature: 1.0
2025-12-08 00:56:50 - src.models.probability_extractor - INFO -   Calibration method: None
2025-12-08 00:56:50 - src.utils.gpu - INFO - [probability_extraction] Duration: 276.74ms | GPU Memory: 5311.0MB -> 5311.0MB (delta +0.0MB)
2025-12-08 00:56:50 - __main__ - INFO -     Raw probabilities saved to: outputs/results/probabilities/probs_phi-2_ds_float16_base_20251207_231938.npz
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO - Initialized LACScorer
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO -   Alpha: 0.1
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO -   Target coverage: 90.0%
2025-12-08 00:56:50 - src.conformal.scorers - INFO - Initialized LAC (Least Ambiguous set-valued Classifiers) scorer
2025-12-08 00:56:50 - src.conformal.prediction_set_generator - INFO - Initialized PredictionSetGenerator
2025-12-08 00:56:50 - src.conformal.prediction_set_generator - INFO -   Methods: ['lac']
2025-12-08 00:56:50 - src.conformal.prediction_set_generator - INFO -   Alpha: 0.1
2025-12-08 00:56:50 - src.conformal.prediction_set_generator - INFO -   Aggregation: separate
2025-12-08 00:56:50 - src.conformal.prediction_set_generator - INFO - Calibrating 1 conformal predictors...
2025-12-08 00:56:50 - src.conformal.prediction_set_generator - INFO -   Calibrating LAC...
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO - Calibrating with 4999 samples...
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO - Calibration complete
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO -   Threshold: 0.9710
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO -   Score range: [0.0004, 1.0000]
2025-12-08 00:56:50 - src.conformal.prediction_set_generator - INFO - Calibration complete
2025-12-08 00:56:50 - src.conformal.prediction_set_generator - INFO - Generating prediction sets using LAC...
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO - Generating prediction sets for 5001 test instances...
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO - Prediction complete
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO -   Average set size: 5.17
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO -   Coverage rate: 89.80%
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO -   Meets coverage guarantee: False
2025-12-08 00:56:50 - src.conformal.conformal_base - WARNING - ✗ Coverage guarantee NOT met: 89.80% < 90.00%
2025-12-08 00:56:50 - src.conformal.prediction_set_generator - WARNING - LAC does not meet coverage guarantee: 89.80% < 90.00%
2025-12-08 00:56:50 - __main__ - INFO -     LAC: Acc=32.35%, CR=89.80%, SS=5.17
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO - Initialized APSScorer
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO -   Alpha: 0.1
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO -   Target coverage: 90.0%
2025-12-08 00:56:50 - src.conformal.scorers - INFO - Initialized APS (Adaptive Prediction Sets) scorer
2025-12-08 00:56:50 - src.conformal.prediction_set_generator - INFO - Initialized PredictionSetGenerator
2025-12-08 00:56:50 - src.conformal.prediction_set_generator - INFO -   Methods: ['aps']
2025-12-08 00:56:50 - src.conformal.prediction_set_generator - INFO -   Alpha: 0.1
2025-12-08 00:56:50 - src.conformal.prediction_set_generator - INFO -   Aggregation: separate
2025-12-08 00:56:50 - src.conformal.prediction_set_generator - INFO - Calibrating 1 conformal predictors...
2025-12-08 00:56:50 - src.conformal.prediction_set_generator - INFO -   Calibrating APS...
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO - Calibrating with 4999 samples...
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO - Calibration complete
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO -   Threshold: 0.9986
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO -   Score range: [0.1955, 1.0000]
2025-12-08 00:56:50 - src.conformal.prediction_set_generator - INFO - Calibration complete
2025-12-08 00:56:50 - src.conformal.prediction_set_generator - INFO - Generating prediction sets using APS...
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO - Generating prediction sets for 5001 test instances...
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO - Prediction complete
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO -   Average set size: 4.94
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO -   Coverage rate: 89.28%
2025-12-08 00:56:50 - src.conformal.conformal_base - INFO -   Meets coverage guarantee: False
2025-12-08 00:56:50 - src.conformal.conformal_base - WARNING - ✗ Coverage guarantee NOT met: 89.28% < 90.00%
2025-12-08 00:56:50 - src.conformal.prediction_set_generator - WARNING - APS does not meet coverage guarantee: 89.28% < 90.00%
2025-12-08 00:56:50 - __main__ - INFO -     APS: Acc=32.35%, CR=89.28%, SS=4.94
2025-12-08 00:56:55 - src.models.model_loader - INFO - Unloaded model: phi-2_float16
2025-12-08 00:56:56 - __main__ - INFO - Checkpoint saved after completing: phi-2 | ds | float16
2025-12-08 00:56:56 - src.visualization.result_visualizer - INFO - Generating all visualizations...
2025-12-08 00:56:57 - src.visualization.result_visualizer - INFO - Saved heatmap to outputs/results/figures/heatmap_accuracy.png
2025-12-08 00:56:57 - src.visualization.result_visualizer - INFO - Saved heatmap to outputs/results/figures/heatmap_coverage_rate.png
2025-12-08 00:56:58 - src.visualization.result_visualizer - INFO - Saved heatmap to outputs/results/figures/heatmap_avg_set_size.png
2025-12-08 00:56:59 - src.visualization.result_visualizer - INFO - Saved dashboard to outputs/results/figures/dashboard.png
2025-12-08 00:57:00 - src.visualization.result_visualizer - INFO - Saved bar chart to outputs/results/figures/bar_comparison_accuracy.png
2025-12-08 00:57:00 - src.visualization.result_visualizer - INFO - Saved bar chart to outputs/results/figures/bar_comparison_avg_set_size.png
2025-12-08 00:57:01 - src.visualization.result_visualizer - INFO - Saved radar chart to outputs/results/figures/radar_chart.png
2025-12-08 00:57:01 - src.visualization.result_visualizer - INFO - Saved uncertainty analysis to outputs/results/figures/uncertainty_analysis.png
2025-12-08 00:57:01 - src.visualization.result_visualizer - INFO - Saved summary table to outputs/results/figures/results_summary.md
2025-12-08 00:57:01 - src.visualization.result_visualizer - INFO - Saved summary table to outputs/results/figures/results_summary_lac.md
2025-12-08 00:57:01 - src.visualization.result_visualizer - INFO - Saved summary table to outputs/results/figures/results_summary_aps.md
2025-12-08 00:57:01 - src.visualization.result_visualizer - INFO - All visualizations saved to outputs/results/figures
2025-12-08 00:57:01 - __main__ - INFO - Visualizations saved to: outputs/results/figures
2025-12-08 00:57:03 - src.utils.gpu - INFO - Stopped GPU monitoring. Collected 1902 snapshots.
2025-12-08 00:57:03 - src.utils.gpu - INFO - Saved GPU profiling report to outputs/results/gpu_profile_20251207_231938.json
2025-12-08 00:57:03 - __main__ - INFO - GPU profiling report saved to: outputs/results/gpu_profile_20251207_231938.json
2025-12-08 00:57:03 - __main__ - INFO - 
================================================================================
2025-12-08 00:57:03 - __main__ - INFO - BENCHMARK COMPLETE
2025-12-08 00:57:03 - __main__ - INFO - ================================================================================
2025-12-08 00:57:03 - __main__ - INFO - Total time: 97.26 minutes
2025-12-08 00:57:03 - __main__ - INFO - Results saved to: outputs/results
2025-12-08 00:57:03 - __main__ - INFO - Benchmark completed successfully
2025-12-08 00:57:03 - __main__ - INFO - Total runs: 10
2025-12-08 00:57:03 - __main__ - INFO - Overall accuracy: 24.44%
2025-12-08 00:57:03 - __main__ - INFO - Overall coverage: 92.50%
2025-12-08 00:57:03 - __main__ - INFO - Log file saved to: outputs/results/logs/benchmark_20251207_231938.log
